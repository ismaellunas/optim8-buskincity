import{M as _}from"./HasModal-fa56130c.js";import{B as v}from"./LanguageTab-ce3e8bfb.js";import L from"./NavigationFormDuplicate-f84f4b98.js";import F from"./NavigationFormMenuItem-1addcf82.js";import b from"./NavigationMenu-1d34b455.js";import{I as m,H as E,l,f as O,i as n,p as d,u as p,s as h,r as u,o as r}from"./vue-loading.min-a6a947f0.js";import{a as M,o as N,s as y}from"./alert-fe3154bb.js";import{_ as C}from"./_plugin-vue_export-helper-c27b6911.js";import"./Button-03e0d3fd.js";import"./HasPageErrors-da5616c1.js";import"./utils-caa7a80b.js";import"./Checkbox-8f917da5.js";import"./Input-137492c5.js";import"./Field-a8082082.js";import"./Field-e1691255.js";import"./Input-4c73d710.js";import"./InputError-9b7084c8.js";import"./Select-a178b677.js";import"./Select-19a91b6e.js";import"./ModalCard-06597c5e.js";import"./vuedraggable.umd-d7851836.js";import"./ThemeMenuItem-be410961.js";import"./Tag-8100534e.js";import"./icon-class-4ab3933f.js";import"./sweetalert2.all-7b2d1616.js";const R={name:"ThemeHeaderNavigation",components:{BizLanguageTab:v,NavigationFormDuplicate:L,NavigationFormMenu:F,NavigationMenu:b},mixins:[_],props:{menu:{type:Object,required:!0},headerMenus:{type:Object,default:()=>{}},title:{type:String,default:"-"}},setup(){return{baseRouteName:m().props.value.baseRouteName??null,localeOptions:m().props.value.languageOptions??[],defaultLocale:m().props.value.defaultLanguage,tabs:{layout:{title:"Layout"},navigation:{title:"Navigation"}}}},data(){return{activeTab:"navigation",isModalDuplicateOpen:!1,lastDataMenuItems:[],loader:null,menuForm:{},selectedLocale:this.defaultLocale,selectedMenuItem:{},menuItemErrors:{},validationRoute:route("admin.api.theme.header.menu-item.validate")}},mounted(){this.menuForm=this.getMenuForm(this.selectedLocale),this.updateLastDataMenuItems()},methods:{isFormDirty(){return this.menuForm.isDirty},getMenuForm(t){return E({locale:t,menu_items:l.cloneDeep(this.headerMenus[t])})},onChangeLocale(t){this.menuForm.isDirty?M().then(e=>{if(e.isDismissed)return!1;e.isConfirmed&&(this.selectedLocale=t,this.menuForm.reset(),this.menuForm=this.getMenuForm(t),this.updateLastDataMenuItems())}):(this.selectedLocale=t,this.menuForm=this.getMenuForm(t),this.updateLastDataMenuItems())},openFormModal(){this.selectedMenuItem={},this.menuItemErrors={},this.isModalOpen=!0},openDuplicateModal(t){const e=l.cloneDeep(t);e.id=null,e.parent_id=null,e.children=[],e.locale=this.selectedLocale,this.selectedMenuItem=e,this.menuItemErrors={},this.isModalDuplicateOpen=!0},closeDuplicateModal(){this.selectedMenuItem={},this.menuItemErrors={},this.isModalDuplicateOpen=!1},checkNestedMenuItems(){let t=this;l.forEach(t.menuForm.menu_items,function(e){l.forEach(e.children,function(o){o.children.length>0&&(t.menuForm.menu_items=t.lastDataMenuItems,N(null))})}),t.updateLastDataMenuItems()},updateLastDataMenuItems(){this.lastDataMenuItems=l.cloneDeep(this.menuForm.menu_items)},updateMenuItem(t){const e=this;axios.post(e.validationRoute,t).then(()=>{e.updateSelectedMenu(t),e.updateLastDataMenuItems(),e.closeModal()}).catch(o=>{e.menuItemErrors=o.response.data.errors})},updateSelectedMenu(t){this.selectedMenuItem.title=t.title,this.selectedMenuItem.type=t.type,this.selectedMenuItem.url=t.url,this.selectedMenuItem.is_blank=t.is_blank,this.selectedMenuItem.menu_itemable_id=t.menu_itemable_id},addMenuItem(t){const e=this;axios.post(e.validationRoute,t).then(()=>{e.menuForm.menu_items.push(l.cloneDeep(t)),e.updateLastDataMenuItems(),e.closeModal()}).catch(o=>{e.menuItemErrors=o.response.data.errors})},editRow(t){this.selectedMenuItem=t,this.menuItemErrors={},this.openModal()},updateMenuItems(){const t=this;this.menuForm.post(route(this.baseRouteName+".update-menu-item"),{preserveScroll:!0,onStart:e=>{t.loader=t.$loading.show()},onSuccess:e=>{y(e.props.flash.message),this.updateLastDataMenuItems()},onFinish:e=>{t.loader.hide()}})},duplicateMenuItem(t){const e=this;axios.post(e.validationRoute,t).then(()=>{e.menuForm.isDirty&&e.selectedLocale!==t.locale?M().then(o=>{if(o.isDismissed)return!1;o.isConfirmed&&(e.selectedLocale=t.locale,e.menuForm=e.getMenuForm(t.locale),e.menuForm.menu_items.push(t),e.closeDuplicateModal(),e.updateLastDataMenuItems())}):(e.selectedLocale!==t.locale&&(e.selectedLocale=t.locale,e.menuForm=e.getMenuForm(t.locale)),e.menuForm.menu_items.push(t),e.closeDuplicateModal(),e.updateLastDataMenuItems())}).catch(o=>{e.menuItemErrors=o.response.data.errors})}}},k={class:"columns"},x=n("div",{class:"column"},[n("div",{class:"is-pulled-left"},[n("b",null,"Menu Items"),n("br")])],-1),B={class:"column"},S={class:"columns"},w={class:"column"};function U(t,e,o,i,a,s){const f=u("biz-language-tab"),I=u("navigation-menu"),g=u("navigation-form-menu"),D=u("navigation-form-duplicate");return r(),O("section",null,[n("div",k,[x,n("div",B,[d(f,{class:"is-right","locale-options":i.localeOptions,"selected-locale":a.selectedLocale,onOnChangeLocale:s.onChangeLocale},null,8,["locale-options","selected-locale","onOnChangeLocale"])])]),n("div",S,[n("div",w,[d(I,{"is-child":!1,"menu-items":a.menuForm.menu_items,"locale-options":i.localeOptions,"selected-locale":a.selectedLocale,onChange:s.checkNestedMenuItems,onDuplicateMenuItem:s.openDuplicateModal,onEditRow:s.editRow,onOpenFormModal:e[0]||(e[0]=c=>s.openFormModal()),onUpdateLastDataMenuItems:s.updateLastDataMenuItems},null,8,["menu-items","locale-options","selected-locale","onChange","onDuplicateMenuItem","onEditRow","onUpdateLastDataMenuItems"])])]),t.isModalOpen?(r(),p(g,{key:0,"base-route-name":i.baseRouteName,errors:a.menuItemErrors,menu:o.menu,"menu-item":a.selectedMenuItem,"selected-locale":a.selectedLocale,onAddMenuItem:s.addMenuItem,onClose:e[1]||(e[1]=c=>t.closeModal()),onUpdateMenuItem:s.updateMenuItem},null,8,["base-route-name","errors","menu","menu-item","selected-locale","onAddMenuItem","onUpdateMenuItem"])):h("",!0),a.isModalDuplicateOpen?(r(),p(D,{key:1,errors:a.menuItemErrors,"locale-options":i.localeOptions,"menu-item":a.selectedMenuItem,onClose:e[2]||(e[2]=c=>s.closeDuplicateModal()),onDuplicateMenuItem:s.duplicateMenuItem},null,8,["errors","locale-options","menu-item","onDuplicateMenuItem"])):h("",!0)])}const ue=C(R,[["render",U]]);export{ue as default};
