import{M as j}from"./HasLoader-a564cfe6.js";import{M as N}from"./HasTab-77ca33c2.js";import{A as I}from"./AppLayout-25ccdbdb.js";import{B as D}from"./Button-b3acaac2.js";import{B as A}from"./ButtonIcon-05c24ca4.js";import{B as q}from"./ButtonLink-71ebb617.js";import{B as H}from"./AssignUser-278ac4f6.js";import{B as Y}from"./Select-c82d82bb.js";import{B as J,a as G}from"./Tabs-f7006a1f.js";import Q from"./Form-c82c4cb9.js";import W from"./SpaceEvent-a21cfb1a.js";import X from"./SpaceForm-49247431.js";import Z from"./SpaceFormTranslatable-ac55a0bb.js";import{I as L,B as u,H as _,l as g,J as S,u as w,q as r,r as d,o as f,i as l,p as i,w as O,k as p,f as B,j as K,t as T,F as $,s as ee}from"./vue-loading.min-aa20e13d.js";import{s as v,o as h,a as te,c as ae}from"./alert-e0e75cb7.js";import{g as oe}from"./page-9994df2c.js";import{g as se}from"./translation-406eee2f.js";import{i as F}from"./utils-79a9c8b1.js";import{p as re}from"./icon-class-4ab3933f.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";import"./Breadcrumbs-0b4348b1.js";import"./Link-2bcf0cab.js";import"./NavbarItem-7e983d41.js";import"./Icon-150b61ef.js";import"./DropdownSearch-783ef1d1.js";import"./Field-fbae01a6.js";import"./Field-c2e062a9.js";import"./InputError-bc1e9f36.js";import"./DropdownSearch-bd4068c6.js";import"./Dropdown-5425ae3a.js";import"./Input-2fb71e37.js";import"./Select-9fda6861.js";import"./HasModal-fa56130c.js";import"./LanguageTab-090d99fd.js";import"./ModalCard-42b1747b.js";import"./FormBuilder-907cd83e.js";import"./Card-52ddfc57.js";import"./TRBLInput-45f07beb.js";import"./Checkbox-8d9a17c8.js";import"./Input-50a73630.js";import"./NumberAddons-c3a445ee.js";import"./Number-2731510a.js";import"./FieldHorizontal-b8491cae.js";import"./style-options-cda219e9.js";import"./MediaTextEditor-0dbb0342.js";import"./MediaLibrary-5a0e38b7.js";import"./HasPageErrors-4d447fdf.js";import"./ButtonsDisplayView-1ca29618.js";import"./Search-cafe34ab.js";import"./Image-52e0dacd.js";import"./InputFile-1187b7e3.js";import"./Gallery-48abb118.js";import"./ButtonDownload-ab8e1361.js";import"./Modal-247c5739.js";import"./Table-2efbef14.js";import"./cropper-5d594675.js";import"./Pagination-8d9b0028.js";import"./TableInfo-c372d0e5.js";import"./Form-a078ed17.js";import"./ErrorNotifications-805a6bc2.js";import"./Textarea-18e9b25c.js";import"./Textarea-3c29db5c.js";import"./fontawesome-brand-classes-2990e3e2.js";import"./vuedraggable.umd-12c8e910.js";import"./ToolbarContent-f242e09a.js";import"./EditorTinymce-70ed286a.js";import"./FormDetail-7f9c2855.js";import"./Slug-b92c239f.js";import"./InputAddons-48095339.js";import"./FormSetting-c2ddf47a.js";import"./TableIndex-6b2a4ef8.js";import"./SpaceEventFormModal-4c65f45f.js";import"./DateTime-b3a25f5d.js";import"./Datepicker-847140ac.js";import"./File-df13363c.js";import"./SpaceModalContact-6304ce14.js";import"./Phone-f71a3985.js";import"./DropdownScroll-6bec070e.js";import"./sweetalert2.all-ebd52f41.js";const ne={components:{AppLayout:I,BizButton:D,BizButtonIcon:A,BizButtonLink:q,BizFormAssignUser:H,BizFormSelect:Y,BizProvideInjectTab:J,BizProvideInjectTabs:G,PageForm:Q,SpaceEvent:W,SpaceForm:X,SpaceFormTranslatable:Z},mixins:[j,N],provide(){return{can:this.can}},props:{baseRouteName:{type:String,default:""},breadcrumbs:{type:Array,default:()=>[]},can:{type:Object,required:!0},coverUrl:{type:String,default:""},defaultCountry:{type:String,required:!0},errors:{type:Object,default:()=>{}},instructions:{type:Object,required:!0},logoUrl:{type:String,default:""},page:{type:Object,required:!0},parentOptions:{type:Object,default:()=>{}},spaceManagers:{type:Array,default:()=>[]},spaceRecord:{type:Object,required:!0},statusOptions:{type:Array,default:()=>[]},tab:{type:Number,default:0},title:{type:String,default:""},i18n:{type:Object,default:()=>{}},typeOptions:{type:Object,default:()=>{}}},setup(e){const t=L().props.value.defaultLanguage,a=oe({isDefaultSettingsProvided:!1});return{activeTab:u(e.tab),contentConfigId:u(""),defaultLocale:t,emptyTranslatedPage:a,iconPreview:re,localeOptions:L().props.value.languageOptions,pageEnabledOptions:{No:!1,Yes:!0},pageForm:u(null),routeIndex:route(e.baseRouteName+".index"),selectedLocale:u(null)}},data(){return{managers:this.spaceManagers,productManagers:this.spaceProductManagers,space:{}}},computed:{isPageNew(){var e;return!((e=this.page)!=null&&e.id)},isPageRendered(){return this.spaceRecord.is_page_enabled&&this.can.page.edit},isManagerRendered(){return this.can.manager.edit},isEventRendered(){return this.can.update},currentTranslatedPage(){return se(this.page,this.selectedLocale,{isDefaultSettingsProvided:!1})},pagePreviewUrl(){return F(this.currentTranslatedPage.landingPageSpaceUrl)?null:this.currentTranslatedPage.landingPageSpaceUrl+"?&preview"},canPreviewPage(){return this.currentTranslatedPage&&this.pagePreviewUrl}},beforeMount(){this.setSpace()},mounted(){this.changeLocale(this.defaultLocale)},methods:{submit(){const e=this,t=route(e.baseRouteName+".update",e.spaceRecord.id);e.space.transform(a=>({...a,_method:"put"})).post(t,{onStart:e.onStartLoadingOverlay,onSuccess:a=>{e.space.deleted_media={},e.space.logo=null,e.space.cover=null,v(a.props.flash.message)},onError:()=>{h()},onFinish:()=>{e.onEndLoadingOverlay()}})},submitManager(){const e=this;_({managers:g.map(this.managers,"id")}).post(route(e.baseRouteName+".update-managers",e.spaceRecord.id),{replace:!0,onStart:e.onStartLoadingOverlay,onSuccess:a=>{v(a.props.flash.message)},onError:()=>{h()},onFinish:e.onEndLoadingOverlay})},setSpace(){const e=g.pick(this.spaceRecord,["id","address","contacts","is_page_enabled","latitude","longitude","name","parent_id","translations","type_id"]);e.logo=null,e.cover=null,e.deleted_media={},this.space=_(e)},onChangeLocale(e){if(this.isPageNew){const t=this.localeOptions.find(a=>a.id==this.defaultLocale);h({text:"Please provide "+t.name+" ("+t.id.toUpperCase()+") translation first!"})}else this.pageForm.isDirty?te().then(t=>{if(t.isDismissed)return!1;t.isConfirmed&&this.changeLocale(e)}):this.changeLocale(e)},changeLocale(e){this.selectedLocale=e,this.setTranslationForm(e)},setTranslationForm(e){let t={[this.defaultLocale]:{}};const a=this.currentTranslatedPage;F(a)?t[e]=g.cloneDeep(this.emptyTranslatedPage):t[e]=g.cloneDeep(a),this.pageForm=_(t)},isUsedByMenu(){const e=this;return new Promise((t,a)=>{const s=route("admin.api.spaces.is-used-by-menu",{space:e.spaceRecord.id,locale:e.selectedLocale});axios.get(s).then(n=>{t(n.data==!0)}).catch(n=>{a(n)})})},async canSavePage(){try{const e=this.pageForm[this.selectedLocale].status;return this.currentTranslatedPage&&this.currentTranslatedPage.status==S.published&&e==S.draft&&await this.isUsedByMenu()?!!(await ae("Are You Sure?","This action will also remove the page on the navigation menu.","Yes")).value:!0}catch(e){return console.error(e),!0}},async submitPage(){var e;if(await this.canSavePage()){let t=null,a=null;(e=this.page)!=null&&e.id?(t="put",a=route("admin.spaces.pages.update",[this.spaceRecord.id,this.page.id])):(t="post",a=route("admin.spaces.pages.store",this.spaceRecord.id));const s={replace:!0,onStart:this.onStartLoadingOverlay,onSuccess:n=>{this.pageForm[this.selectedLocale].id=this.currentTranslatedPage.id,v(n.props.flash.message)},onError:()=>{h()},onFinish:()=>{this.setTranslationForm(this.selectedLocale),this.onEndLoadingOverlay()}};this.pageForm.submit(t,a,s)}},previewPage(){window.open(this.pagePreviewUrl,"_blank")}}},le={class:"buttons is-right"},ce=l("span",null,"Page Preview",-1),de={class:"box mb-6"},pe=["value"],me={class:"field is-grouped is-grouped-right mt-4"},ue={class:"control"},ge={class:"control"},fe={class:"field is-grouped is-grouped-right mt-4"},he={class:"control"},be={class:"field is-grouped is-grouped-right"},_e={class:"control"},ve={class:"control"};function ye(e,t,a,s,n,c){const C=d("biz-button-icon"),U=d("biz-form-select"),z=d("space-form-translatable"),y=d("biz-button-link"),b=d("biz-button"),V=d("space-form"),m=d("biz-provide-inject-tab"),k=d("space-event"),R=d("biz-form-assign-user"),M=d("page-form"),E=d("biz-provide-inject-tabs"),x=d("app-layout");return f(),w(x,{breadcrumbs:a.breadcrumbs,title:a.title},{sideBreadcrumbs:r(()=>[l("p",le,[i(C,{disabled:!c.canPreviewPage,icon:s.iconPreview,onClick:c.previewPage},{default:r(()=>[ce]),_:1},8,["disabled","icon","onClick"])])]),default:r(()=>[l("div",null,[l("div",de,[i(E,{modelValue:s.activeTab,"onUpdate:modelValue":t[8]||(t[8]=o=>s.activeTab=o),class:"is-boxed"},{default:r(()=>[i(m,{title:a.i18n.space},{default:r(()=>[l("form",{action:"",onSubmit:t[3]||(t[3]=O((...o)=>c.submit&&c.submit(...o),["prevent"]))},[i(V,{modelValue:n.space,"onUpdate:modelValue":t[2]||(t[2]=o=>n.space=o),"cover-url":a.coverUrl,"default-country":a.defaultCountry,instructions:a.instructions,"logo-url":a.logoUrl,"parent-options":a.parentOptions,"type-options":a.typeOptions,"can-change-parent":a.can.changeParent},{action:r(()=>[l("div",me,[l("div",ue,[i(y,{href:s.routeIndex,class:"is-link is-light"},{default:r(()=>[p(" Cancel ")]),_:1},8,["href"])]),l("div",ge,[i(b,{class:"is-link"},{default:r(()=>[p(" Update ")]),_:1})])])]),default:r(()=>[a.can.page.edit?(f(),w(U,{key:0,modelValue:n.space.is_page_enabled,"onUpdate:modelValue":t[0]||(t[0]=o=>n.space.is_page_enabled=o),label:"Is Page Enabled ?"},{default:r(()=>[(f(!0),B($,null,K(s.pageEnabledOptions,(o,P)=>(f(),B("option",{key:P,value:o,class:"is-capitalize"},T(P),9,pe))),128))]),_:1},8,["modelValue"])):ee("",!0),i(z,{modelValue:n.space,"onUpdate:modelValue":t[1]||(t[1]=o=>n.space=o),class:"py-2"},null,8,["modelValue"])]),_:1},8,["modelValue","cover-url","default-country","instructions","logo-url","parent-options","type-options","can-change-parent"])],32)]),_:1},8,["title"]),i(m,{title:"Event","is-rendered":c.isEventRendered},{default:r(()=>[i(k,{space:n.space},null,8,["space"])]),_:1},8,["is-rendered"]),i(m,{title:"Manager","is-rendered":c.isManagerRendered},{default:r(()=>[l("form",{class:"box",onSubmit:t[5]||(t[5]=O((...o)=>c.submitManager&&c.submitManager(...o),["prevent"]))},[i(R,{modelValue:n.managers,"onUpdate:modelValue":t[4]||(t[4]=o=>n.managers=o),label:"Choose Manager","get-users-url":e.route("admin.spaces.search-managers")},null,8,["modelValue","get-users-url"]),l("div",fe,[l("div",he,[i(b,{class:"is-link"},{default:r(()=>[p(" Update ")]),_:1})])])],32)]),_:1},8,["is-rendered"]),i(m,{title:"Page","is-rendered":c.isPageRendered},{default:r(()=>[i(M,{modelValue:s.pageForm[s.selectedLocale],"onUpdate:modelValue":t[6]||(t[6]=o=>s.pageForm[s.selectedLocale]=o),"content-config-id":s.contentConfigId,"onUpdate:contentConfigId":t[7]||(t[7]=o=>s.contentConfigId=o),errors:a.errors,"is-dirty":s.pageForm.isDirty,"is-new":c.isPageNew,"is-page-builder-rendered":!1,"is-page-setting-rendered":!1,"locale-options":s.localeOptions,"selected-locale":s.selectedLocale,"status-options":a.statusOptions,onOnChangeLocale:c.onChangeLocale},{action:r(o=>[l("div",be,[l("div",_e,[i(y,{class:"is-link is-light",href:e.route("admin.spaces.index")},{default:r(()=>[p(" Cancel ")]),_:1},8,["href"])]),l("div",ve,[i(b,{class:"is-link",onClick:c.submitPage},{default:r(()=>[p(T(o.isNew?"Create":"Update"),1)]),_:2},1032,["onClick"])])])]),_:1},8,["modelValue","content-config-id","errors","is-dirty","is-new","locale-options","selected-locale","status-options","onOnChangeLocale"])]),_:1},8,["is-rendered"])]),_:1},8,["modelValue"])])])]),_:1},8,["breadcrumbs","title"])}const Jt=ie(ne,[["render",ye]]);export{Jt as default};
