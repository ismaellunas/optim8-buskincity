import{B as P}from"./Button-b3acaac2.js";import{B as F}from"./ButtonIcon-05c24ca4.js";import{a as D}from"./Field-fbae01a6.js";import{B as E}from"./Image-52e0dacd.js";import{B as q}from"./InputError-bc1e9f36.js";import{B as O}from"./InputFile-1187b7e3.js";import{B as R}from"./ModalCard-42b1747b.js";import{u as v,e as T}from"./utils-79a9c8b1.js";import{l as I,r,o as s,u as h,q as n,i,k as y,f,F as w,t as b,s as g,p as d,x as k,Q as S,ah as x,w as z,j as A,n as L}from"./vue-loading.min-aa20e13d.js";import{_ as j}from"./cropper-5d594675.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";import{o as H,c as X}from"./alert-e0e75cb7.js";const Y={name:"BizModalImageEditorSquare",components:{BizButton:P,BizButtonIcon:F,BizModalCard:R,VueCropper:j},props:{cropperOptions:{type:Object,default:()=>{}},fileName:{type:String,default:""},isDebugMode:{type:Boolean,default:!1},isHuge:{type:Boolean,default:!0},isProcessing:{type:Boolean,default:!1},modelValue:{}},emits:["close","update:modelValue"],setup(o,{emit:t}){const e={autoCrop:!0,autoCropArea:1,checkCrossOrigin:!0,cropBoxMovable:!1,cropBoxResizable:!1,dragMode:"move",initialAspectRatio:1,minContainerHeight:400};return{mergedCropperOptions:I.merge(e,o.cropperOptions),previewFileSrc:v(o,t)}},data(){return{imageData:null}},methods:{rotateRight(){this.$refs.cropper.rotate(90)},rotateLeft(){this.$refs.cropper.rotate(-90)},flipY(o){const t=o.currentTarget;let e=t.getAttribute("data-scale");e=e?-e:-1,this.$refs.cropper.scaleY(e),t.setAttribute("data-scale",e)},flipX(o){const t=o.currentTarget;let e=t.getAttribute("data-scale");e=e?-e:-1,this.$refs.cropper.scaleX(e),t.setAttribute("data-scale",e)},updateImageData(){this.isDebugMode&&(this.imageData=this.$refs.cropper.getData(!0))}}},W={class:"modal-card-title mb-1"},Q=i("div",{class:"column is-2"},null,-1),G={class:"column is-8 has-text-centered"},J={class:"columns"},K={class:"column py-0"},Z={class:"column is-2"},$={class:"is-pulled-right"},ee=i("div",{class:"is-clearfix"},null,-1),te={id:"image-editor-container"};function oe(o,t,e,u,c,l){const C=r("biz-button"),m=r("biz-button-icon"),_=r("vue-cropper"),B=r("biz-modal-card");return s(),h(B,{"content-class":{"is-huge":e.isHuge},"is-close-hidden":!0},{header:n(()=>[i("p",W,[y(" Image Editor "),e.fileName?(s(),f(w,{key:0},[y(" : "+b(e.fileName),1)],64)):g("",!0)]),d(C,{"aria-label":"close",class:"delete is-primary",type:"button",disabled:e.isProcessing,onClick:t[0]||(t[0]=p=>o.$emit("close"))},null,8,["disabled"])]),footer:n(()=>[Q,i("div",G,[i("div",J,[i("div",K,[d(m,{icon:"fas fa-undo-alt","icon-class":"is-small",title:"Rotate Counterclockwise",type:"button",disabled:e.isProcessing,onClick:l.rotateLeft},null,8,["disabled","onClick"]),d(m,{icon:"fas fa-redo-alt","icon-class":"is-small",title:"Rotate Clockwise",type:"button",disabled:e.isProcessing,onClick:l.rotateRight},null,8,["disabled","onClick"]),d(m,{icon:"fas fa-arrows-alt-h","icon-class":"is-small",title:"Flip Horizontal",type:"button",disabled:e.isProcessing,onClick:t[1]||(t[1]=p=>l.flipX(p))},null,8,["disabled"]),d(m,{icon:"fas fa-arrows-alt-v","icon-class":"is-small",title:"Flip Vertical",type:"button",disabled:e.isProcessing,onClick:t[2]||(t[2]=p=>l.flipY(p))},null,8,["disabled"])])])]),i("div",Z,[i("div",$,[k(o.$slots,"actions")]),ee])]),default:n(()=>[i("div",te,[d(_,S({ref:"cropper",alt:"Source Image"},u.mergedCropperOptions,{src:u.previewFileSrc,onCrop:l.updateImageData}),null,16,["src","onCrop"])])]),_:3},8,["content-class"])}const le=N(Y,[["render",oe]]),ie={name:"BizFormImageSquare",components:{BizButton:P,BizButtonIcon:F,BizFormField:D,BizImage:E,BizInputError:q,BizInputFile:O,BizModalImageEditorSquare:le},inheritAttrs:!1,props:{acceptedTypes:{type:Array,default:x},croppedImageType:{type:String,default:"image/jpeg"},isRoundedPreview:{type:Boolean,default:!1},label:{type:String,default:""},labelDelete:{type:String,default:"Remove"},labelReset:{type:String,default:"Reset"},message:{type:[Array,Object,String],default:void 0},modelValue:{type:[File,Blob,null],required:!0},photoUrl:{type:[String,null],default:null},disabled:{type:Boolean,default:!1},originalImage:{type:[String,null],default:null},required:{type:Boolean,default:null},showDeleteButton:{type:Boolean,default:!1},modalTitle:{type:String,default:"Image"},notes:{type:Array,default:()=>[]},wrapperClass:{type:[Array,Object,String],default:""}},emits:["on-blur","on-delete-image","on-cropped-image","on-reset-preview","update:modelValue","update:photoUrl"],setup(o,{emit:t}){return{computedPhoto:v(o,t),computedPhotoUrl:v(o,t,"photoUrl")}},data(){return{fileNames:[],isImageEdit:!1,photoSelected:null,photoUrlCropper:null}},computed:{displayedFileName(){return this.computedPhoto&&this.fileNames.length>0?I.last(this.fileNames):null},isDeleteButtonShown(){return this.originalImage&&this.computedPhotoUrl&&this.showDeleteButton}},methods:{onFilePicked(o){const t="."+this.photoSelected.type.split("/")[1];I.includes(this.acceptedTypes,t)?(this.fileNames.push(this.photoSelected.name),this.photoUrlCropper=o.target.result,this.openImageEditorModal()):(this.closeImageEditorModal(),H({text:"File must be a image format!"})),this.photoSelected=null},getCropper(){return this.$refs.cropperModal.$refs.cropper},updateImageFile(){const o=this;T(o.getCropper().getCroppedCanvas({maxWidth:4096,maxHeight:4096}),o.croppedImageType).then(t=>{o.computedPhoto=t,o.computedPhotoUrl=URL.createObjectURL(t),o.keepLatestFileNameOnly(),o.closeImageEditorModal(),o.$emit("on-cropped-image")})},openImageEditorModal(){this.isImageEdit=!0},usePrevFileName(){this.fileNames.pop()},keepLatestFileNameOnly(){this.displayedFileName&&(this.fileNames=[this.displayedFileName])},closeImageEditorModal(){this.isImageEdit=!1},resetPreview(){this.usePrevFileName(),this.computedPhoto=null,this.computedPhotoUrl=this.originalImage,this.$emit("on-reset-preview")},deleteImage(o){const t=this;X().then(e=>{e.isConfirmed&&(t.computedPhotoUrl=null,t.$emit("on-delete-image",o))})}}},ae={key:0,class:"field is-narrow"},se={class:"has-text-weight-bold"},re={class:"has-text-weight-bold"},ne={key:0,class:"help is-info"};function de(o,t,e,u,c,l){const C=r("biz-image"),m=r("biz-input-file"),_=r("biz-button-icon"),B=r("biz-input-error"),p=r("biz-form-field"),U=r("biz-button"),V=r("biz-modal-image-editor-square");return s(),f("div",{class:L(e.wrapperClass)},[u.computedPhotoUrl||o.$slots.defaultImageView?(s(),f("div",ae,[u.computedPhotoUrl?(s(),h(C,{key:0,ratio:"is-128x128",rounded:e.isRoundedPreview?"is-rounded":"",src:u.computedPhotoUrl},null,8,["rounded","src"])):k(o.$slots,"defaultImageView",{key:1})])):g("",!0),d(p,{"is-required":e.required},{label:n(()=>[y(b(e.label),1)]),error:n(()=>[d(B,{message:e.message},null,8,["message"])]),default:n(()=>[d(m,S({ref:"input"},o.$attrs,{modelValue:c.photoSelected,"onUpdate:modelValue":t[0]||(t[0]=a=>c.photoSelected=a),"file-label":"Choose a picture",accept:e.acceptedTypes,class:{"is-danger":e.message},disabled:e.disabled,"displayed-file-name":l.displayedFileName,"is-name-displayed":!0,required:e.required,onBlur:t[1]||(t[1]=a=>o.$emit("on-blur",a)),onOnFilePicked:l.onFilePicked}),null,16,["modelValue","accept","class","disabled","displayed-file-name","required","onOnFilePicked"]),l.isDeleteButtonShown?(s(),h(_,{key:0,class:"is-danger is-small mt-3 mr-2",icon:"fa-solid fa-trash-can","icon-class":"is-small",type:"button",disabled:e.disabled,onClick:t[2]||(t[2]=z(a=>l.deleteImage(a),["prevent"]))},{default:n(()=>[i("span",se,b(e.labelDelete),1)]),_:1},8,["disabled"])):g("",!0),u.computedPhoto?(s(),h(_,{key:1,class:"is-warning is-small mt-3 mr-2",icon:"far fa-history","icon-class":"is-small",type:"button",disabled:e.disabled,onClick:z(l.resetPreview,["prevent"])},{default:n(()=>[i("span",re,b(e.labelReset),1)]),_:1},8,["disabled","onClick"])):g("",!0),k(o.$slots,"note",{},()=>[e.notes?(s(),f("p",ne,[i("ul",null,[(s(!0),f(w,null,A(e.notes,(a,M)=>(s(),f("li",{key:M},b(a),1))),128))])])):g("",!0)])]),_:3},8,["is-required"]),c.isImageEdit?(s(),h(V,{key:1,ref:"cropperModal",modelValue:c.photoUrlCropper,"onUpdate:modelValue":t[4]||(t[4]=a=>c.photoUrlCropper=a),"is-huge":!1,"modal-title":e.modalTitle,onClose:t[5]||(t[5]=a=>[l.usePrevFileName(),l.closeImageEditorModal()])},{actions:n(()=>[d(U,{type:"button",class:"is-link",disabled:e.disabled,onClick:t[3]||(t[3]=a=>l.updateImageFile())},{default:n(()=>[y(" Done ")]),_:1},8,["disabled"])]),_:1},8,["modelValue","modal-title"])):g("",!0)],2)}const ve=N(ie,[["render",de]]);export{ve as B};
