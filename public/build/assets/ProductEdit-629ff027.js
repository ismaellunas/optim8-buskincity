import{M as K}from"./HasLoader-a564cfe6.js";import{M as G}from"./HasModal-fa56130c.js";import{M as W}from"./HasPageErrors-4d447fdf.js";import{M as J}from"./HasTab-77ca33c2.js";import{A as Q}from"./AppLayout-25ccdbdb.js";import{B as X}from"./Button-b3acaac2.js";import{B as Z}from"./ButtonIcon-05c24ca4.js";import{B as $}from"./ButtonLink-71ebb617.js";import{B as ee}from"./Checkbox-8d9a17c8.js";import{B as te}from"./ErrorNotifications-805a6bc2.js";import{B as oe}from"./AssignUser-278ac4f6.js";import{B as se}from"./Input-50a73630.js";import{B as re}from"./NumberAddons-c3a445ee.js";import{B as ae}from"./Select-c82d82bb.js";import{B as ie}from"./Textarea-18e9b25c.js";import{B as ne}from"./GmapMarker-d39ec1e7.js";import{B as le,a as de}from"./Tabs-f7006a1f.js";import{B as ce}from"./Tag-083af5c2.js";import ue from"./ProductEditModalDateOverride-7aff8a5f.js";import me from"./ProductForm-cc8be414.js";import _e from"./ScheduleRuleTimes-cd5e7f07.js";import{i as ve}from"./icon-class-4ab3933f.js";import{h as M}from"./moment-fbc5633a.js";import{l as f,H as R,B as he,f as c,p as n,q as _,u as w,s as V,r as v,o as d,i as o,k as y,w as S,F as O,j as F,t as B}from"./vue-loading.min-aa20e13d.js";import{s as T,o as C,c as pe}from"./alert-e0e75cb7.js";import{b as U}from"./utils-79a9c8b1.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import"./Breadcrumbs-0b4348b1.js";import"./Link-2bcf0cab.js";import"./NavbarItem-7e983d41.js";import"./Icon-150b61ef.js";import"./DropdownSearch-783ef1d1.js";import"./Field-fbae01a6.js";import"./Field-c2e062a9.js";import"./InputError-bc1e9f36.js";import"./DropdownSearch-bd4068c6.js";import"./Dropdown-5425ae3a.js";import"./Input-2fb71e37.js";import"./Number-2731510a.js";import"./Select-9fda6861.js";import"./Textarea-3c29db5c.js";import"./map-049204a6.js";import"./Datepicker-847140ac.js";import"./ModalCard-42b1747b.js";import"./CheckboxToggle-c45bd847.js";import"./CheckboxToggle-b36e31d6.js";import"./FileUpload-9bbd68fd.js";import"./Gallery-48abb118.js";import"./ButtonDownload-ab8e1361.js";import"./Image-52e0dacd.js";import"./Modal-247c5739.js";import"./sweetalert2.all-ebd52f41.js";import"./ScheduleRuleTime-48ecf4e5.js";const ge={components:{BizButton:X,BizButtonIcon:Z,BizButtonLink:$,BizCheckbox:ee,BizErrorNotifications:te,BizFormAssignUser:oe,BizFormInput:se,BizFormNumberAddons:re,BizFormSelect:ae,BizFormTextarea:ie,BizGmapMarker:ne,BizProvideInjectTab:le,BizProvideInjectTabs:de,BizTag:ce,ProductEditModalDateOverride:ue,ProductForm:me,ScheduleRuleTimes:_e},mixins:[K,W,J,G],layout:Q,props:{baseRouteName:{type:String,required:!0},can:{type:Object,required:!0},roleOptions:{type:Array,required:!0},defaultCountryCode:{type:String,required:!0},countryOptions:{type:Array,required:!0},statusOptions:{type:Array,required:!0},eventDurationOptions:{type:Array,required:!0},imageMimes:{type:Array,required:!0},product:{type:Object,required:!0},event:{type:Object,required:!0},timezoneOptions:{type:Object,required:!0},weekdays:{type:Object,required:!0},weeklyHours:{type:Object,required:!0},dateOverrides:{type:Array,required:!0},geoLocation:{type:Object,required:!0},managers:{type:Array,default:()=>[]},googleApiKey:{type:String,default:null},formatDateIso:{type:String,default:"YYYY-MM-DD"},formatDateUser:{type:String,default:"D MMM YYYY"},productManagerBaseRoute:{type:String,required:!0},rules:{type:Object,required:!0}},setup(e,{emit:t}){const a={name:e.product.name,status:e.product.status,description:e.product.description,short_description:e.product.short_description,roles:e.product.roles,is_check_in_required:e.product.is_check_in_required,gallery:{deleted_media:[],files:[]}},s={location:e.event.location,duration:e.event.duration,bookable_date_range:e.event.bookable_date_range,timezone:e.event.timezone,weekly_hours:e.weeklyHours,date_overrides:f.cloneDeep(e.dateOverrides)};return{form:R(a),eventForm:R(s),icon:ve,eventErrors:he({}),eventErrorBag:"updateEvent"}},data(){return{activeTab:0,selectedDateOverrideBatch:null,isMapOpen:!1,productManagers:this.managers,unusedDates:[]}},computed:{dateOverrideBatches(){const e=this,t=this.eventErrorBag,a=[],s=this.eventForm.date_overrides.map((l,i)=>{const u=[];return u.push(e.error(`date_overrides.${i}.started_date`,t)),l.times.forEach((h,g)=>{u.push(e.error(`date_overrides.${i}.times.${g}.started_time`,t),e.error(`date_overrides.${i}.times.${g}.ended_time`,t),e.error(`date_overrides.${i}.times.${g}`,t))}),l.errors=u.filter(Boolean),l});return f.sortBy(s,["started_date"]).filter(l=>!e.unusedDates.includes(l.started_date)).forEach((l,i)=>{const u=f.cloneDeep(l);if(i==0)u.batch=U();else{const h=a[i-1],g=M(h.started_date).add(1,"days").format(e.formatDateIso),k=b=>b.started_time+" - "+b.ended_time;let D=!1;if(u.started_date==g)if(!h.is_available&&!u.is_available)D=!0;else{const b=h.times.map(k).sort(),E=u.times.map(k).sort();D=f.isEqual(b,E)}D?u.batch=h.batch:u.batch=U()}a.push(u)}),f.groupBy(a,l=>l.batch)},dateOverrideBatchErrors(){const e={};return f.forEach(this.dateOverrideBatches,function(t,a){let s=[];t.forEach(function(l){s=s.concat(l.errors)}),e[a]=f.uniq(s)}),e}},methods:{submit(){const e=this,t=route(this.baseRouteName+".update",{product:this.product.id});this.form.transform(a=>({...a,_method:"put"})).post(t,{forceFormData:!0,onStart:e.onStartLoadingOverlay,onSuccess:a=>{e.form.gallery.files=[],e.$refs.product_form.$refs.file_upload.reset(),T(a.props.flash.message)},onError:()=>{C()},onFinish:e.onEndLoadingOverlay})},eventSubmit(){const e=this,t=route(this.baseRouteName+".events.update",{product:this.product.id});this.eventForm.date_overrides=this.eventForm.date_overrides.filter(a=>!e.unusedDates.includes(a.started_date)),this.eventForm.put(t,{errorBag:e.eventErrorBag,onStart:()=>e.onStartLoadingOverlay(),onSuccess:a=>{e.eventForm.date_overrides=f.cloneDeep(a.props.dateOverrides),e.eventErrors={},T(a.props.flash.message)},onError:a=>{e.eventErrors=a,C()},onFinish:()=>e.onEndLoadingOverlay()})},addTimeRange(e){this.$refs["scheduleRuleTime_"+e][0].addTimeRange(),this.eventForm.weekly_hours[e].hours.length>0&&(this.eventForm.weekly_hours[e].is_available=!0),this.eventErrors={}},openDateOverrideModal(e){const t=this;if(t.selectedDateOverrideBatch={batch:null,dates:[],times:[],isAvailable:!1,unusedDates:[]},e){const a=this.dateOverrideBatches[e];let s=[];a.forEach(i=>{s.push(M(i.started_date).toDate())});let l=a[0].times.map(i=>({started_time:i.started_time,ended_time:i.ended_time}));t.selectedDateOverrideBatch.batch=e,t.selectedDateOverrideBatch.dates=s,t.selectedDateOverrideBatch.times=l,t.selectedDateOverrideBatch.isAvailable=a[0].is_available}this.openModal()},afterApply(){const e=this,t=this.eventForm.date_overrides;e.selectedDateOverrideBatch.dates.forEach(s=>{const l=M(s),i=l.format(e.formatDateIso),u=t.findIndex(function(h){return h.started_date==i});if(u===-1)t.push({started_date:i,times:e.selectedDateOverrideBatch.times,is_available:e.selectedDateOverrideBatch.times.length>0,display_dates:l.format(e.formatDateUser)});else{const h=t[u];h.started_date=i,h.times=e.selectedDateOverrideBatch.times,h.is_available=e.selectedDateOverrideBatch.times.length>0}});const a=f.intersection(e.selectedDateOverrideBatch.dates.map(s=>M(s).format(e.formatDateIso)),e.unusedDates);f.remove(e.unusedDates,s=>a.includes(s)),e.selectedDateOverrideBatch.unusedDates.length>0&&(e.unusedDates=e.unusedDates.concat(e.selectedDateOverrideBatch.unusedDates))},displayDates(e){const t=this.dateOverrideBatches[e];let a=t[0].display_dates;return t.length>1&&(a+=" - "+t[t.length-1].display_dates),a},removeDateOverride(e){const t=this;pe("Are you sure want to delete the "+t.displayDates(e)+"?").then(a=>{a.isConfirmed&&t.dateOverrideBatches[e].forEach(s=>{let l=null;const i=t.eventForm.date_overrides.find((u,h)=>(l=h,u.started_date==s.started_date));i&&i.id?t.unusedDates.push(s.started_date):t.eventForm.date_overrides.splice(l,1)})})},toggleMap(){this.isMapOpen=!this.isMapOpen},submitManager(){const e=this,t=R({managers:f.map(this.productManagers,"id")}),a=route(e.productManagerBaseRoute+".update",e.product.id);t.post(a,{replace:!0,onStart:()=>e.onStartLoadingOverlay(),onSuccess:s=>{T(s.props.flash.message)},onError:()=>{C()},onFinish:()=>e.onEndLoadingOverlay()})},timeRangeRemoved(e){const t=this.eventForm.weekly_hours[e];t.hours.length==0&&(t.is_available=!1),this.eventErrors={}},checkTimes(e){const t=this.eventForm.weekly_hours[e];t.is_available?t.hours.length==0&&this.addTimeRange(e):t.hours=[]}}},be={class:"box"},ye=o("hr",null,null,-1),Be={class:"field is-grouped is-grouped-right"},ke={class:"control"},De={class:"control"},Oe={class:"box"},Fe=o("h5",{class:"title is-5 mb-2"}," Details ",-1),ze=o("hr",{class:"mt-0"},null,-1),Me={class:"columns"},Ve={class:"column is-6"},Ee=["value"],qe=o("p",{class:"control"},[o("a",{class:"button is-static"}," minute(s) ")],-1),Ae={class:"column is-6"},Re=o("p",{class:"control"},[o("a",{class:"button is-static"}," day(s) ")],-1),Se={class:"columns"},Te={class:"column is-6"},Ce=["value"],we={class:"column is-5"},Ue={class:"columns is-multiline"},je={class:"column is-12"},Le={class:"column is-12"},Ie={class:"column is-1"},Ne={class:"field"},Pe=o("label",{class:"label"}," Map ",-1),Ye={class:"control"},xe={class:"columns is-multiline"},He={key:0,class:"column is-8"},Ke={class:"card"},Ge={class:"card-content p-2"},We={class:"box"},Je=o("h5",{class:"title is-5 mb-2"}," Schedule ",-1),Qe=o("hr",{class:"mt-0"},null,-1),Xe=["value"],Ze=o("hr",{class:"mt-0"},null,-1),$e={class:"columns"},et={class:"column"},tt={class:"card"},ot=o("header",{class:"card-header"},[o("p",{class:"card-header-title"}," Weekly hours ")],-1),st={class:"card-content"},rt={class:"columns is-multiline"},at={class:"columns"},it={class:"column is-2"},nt={class:"column"},lt={class:"column is-2"},dt={class:"column"},ct={class:"card"},ut=o("header",{class:"card-header"},[o("p",{class:"card-header-title"}," Date overrides ")],-1),mt={class:"card-content"},_t={class:"columns is-multiline"},vt=o("div",{class:"column is-full has-text-centered"}," Add dates when your availability changes from your weekly hours ",-1),ht={class:"column is-full has-text-centered"},pt={class:"column is-full"},ft={class:"column is-5"},gt={class:"column is-4 has-text-centered"},bt={key:0,class:"columns is-multiline"},yt={class:"column is-3 has-text-right"},Bt={class:"field is-grouped is-grouped-right"},kt={class:"control"},Dt={class:"control"},Ot={key:0,class:"column is-full"},Ft=o("hr",null,null,-1),zt={class:"field is-grouped is-grouped-right"},Mt={class:"control"},Vt={class:"control"},Et={class:"field is-grouped is-grouped-right mt-4"},qt={class:"control"};function At(e,t,a,s,l,i){const u=v("biz-error-notifications"),h=v("product-form"),g=v("biz-button-link"),k=v("biz-button"),D=v("biz-provide-inject-tab"),b=v("biz-form-select"),E=v("biz-form-number-addons"),j=v("biz-form-textarea"),q=v("biz-form-input"),z=v("biz-button-icon"),L=v("biz-gmap-marker"),I=v("biz-checkbox"),N=v("schedule-rule-times"),P=v("biz-tag"),Y=v("biz-form-assign-user"),x=v("biz-provide-inject-tabs"),H=v("product-edit-modal-date-override");return d(),c("div",null,[n(u,{errors:e.$page.props.errors,bags:["default"]},null,8,["errors"]),n(x,{modelValue:l.activeTab,"onUpdate:modelValue":t[15]||(t[15]=r=>l.activeTab=r),class:"is-boxed"},{default:_(()=>[n(D,{title:"Product",class:"mb-6"},{default:_(()=>[o("form",{method:"post",onSubmit:t[1]||(t[1]=S((...r)=>i.submit&&i.submit(...r),["prevent"]))},[o("div",be,[n(h,{ref:"product_form",modelValue:s.form,"onUpdate:modelValue":t[0]||(t[0]=r=>s.form=r),"role-options":a.roleOptions,"status-options":a.statusOptions,gallery:a.product.gallery,rules:a.rules,"image-mimes":a.imageMimes},null,8,["modelValue","role-options","status-options","gallery","rules","image-mimes"]),ye,o("div",Be,[o("div",ke,[n(g,{href:e.route(a.baseRouteName+".index"),class:"is-link is-light"},{default:_(()=>[y(" Cancel ")]),_:1},8,["href"])]),o("div",De,[n(k,{class:"is-link"},{default:_(()=>[y(" Update ")]),_:1})])])])],32)]),_:1}),n(D,{id:"product-event-tab",title:"Event",class:"mb-6"},{default:_(()=>[o("form",{onSubmit:t[12]||(t[12]=S((...r)=>i.eventSubmit&&i.eventSubmit(...r),["prevent"]))},[o("div",Oe,[Fe,ze,o("div",Me,[o("div",Ve,[n(b,{modelValue:s.eventForm.duration,"onUpdate:modelValue":t[2]||(t[2]=r=>s.eventForm.duration=r),label:"Duration",message:e.error("duration","eventForm"),"has-addons":"",required:"","is-fullwidth":""},{afterInput:_(()=>[qe]),default:_(()=>[(d(!0),c(O,null,F(a.eventDurationOptions,r=>(d(),c("option",{key:r.id,value:r.id},B(r.value),9,Ee))),128))]),_:1},8,["modelValue","message"])]),o("div",Ae,[n(E,{modelValue:s.eventForm.bookable_date_range,"onUpdate:modelValue":t[3]||(t[3]=r=>s.eventForm.bookable_date_range=r),label:"Bookable date range (Calendar days into the future)",max:"365",min:"0",required:"",message:e.error("bookable_date_range","eventForm")},{afterInput:_(()=>[Re]),_:1},8,["modelValue","message"])])]),o("div",Se,[o("div",Te,[n(j,{modelValue:s.eventForm.location.address,"onUpdate:modelValue":t[4]||(t[4]=r=>s.eventForm.location.address=r),label:"Address",placeholder:"Address",rows:"5",maxlength:"500",message:e.error("location.address",s.eventErrorBag)},null,8,["modelValue","message"]),n(q,{modelValue:s.eventForm.location.city,"onUpdate:modelValue":t[5]||(t[5]=r=>s.eventForm.location.city=r),label:"City",maxlength:"64",required:"",message:e.error("location.city",s.eventErrorBag)},null,8,["modelValue","message"]),n(b,{modelValue:s.eventForm.location.country_code,"onUpdate:modelValue":t[6]||(t[6]=r=>s.eventForm.location.country_code=r),label:"Country",required:""},{default:_(()=>[(d(!0),c(O,null,F(a.countryOptions,r=>(d(),c("option",{key:r.id,value:r.id},B(r.value),9,Ce))),128))]),_:1},8,["modelValue"])]),o("div",we,[o("div",Ue,[o("div",je,[n(q,{modelValue:s.eventForm.location.latitude,"onUpdate:modelValue":t[7]||(t[7]=r=>s.eventForm.location.latitude=r),label:"Latitude",message:e.error("location.latitude",s.eventErrorBag)},null,8,["modelValue","message"])]),o("div",Le,[n(q,{modelValue:s.eventForm.location.longitude,"onUpdate:modelValue":t[8]||(t[8]=r=>s.eventForm.location.longitude=r),label:"Longitude",message:e.error("location.longitude",s.eventErrorBag)},null,8,["modelValue","message"])])])]),o("div",Ie,[o("div",Ne,[Pe,o("span",Ye,[n(z,{type:"button",class:"is-primary",icon:s.icon.locationMark,onClick:i.toggleMap},null,8,["icon","onClick"])])])])]),o("div",xe,[l.isMapOpen?(d(),c("div",He,[o("div",Ke,[o("div",Ge,[n(L,{modelValue:s.eventForm.location,"onUpdate:modelValue":t[9]||(t[9]=r=>s.eventForm.location=r),"api-key":a.googleApiKey,"init-position":a.geoLocation},null,8,["modelValue","api-key","init-position"])])])])):V("",!0)])]),o("div",We,[Je,Qe,n(b,{modelValue:s.eventForm.timezone,"onUpdate:modelValue":t[10]||(t[10]=r=>s.eventForm.timezone=r),label:"Timezone",message:e.error("timezone","eventForm"),required:""},{default:_(()=>[(d(!0),c(O,null,F(a.timezoneOptions,r=>(d(),c("option",{key:r.id,value:r.id},B(r.value),9,Xe))),128))]),_:1},8,["modelValue","message"]),Ze,o("div",$e,[o("div",et,[o("div",tt,[ot,o("div",st,[o("div",rt,[(d(!0),c(O,null,F(a.weekdays,(r,m)=>(d(),c("div",{key:m,class:"column is-full"},[o("div",at,[o("div",it,[n(I,{checked:s.eventForm.weekly_hours[m].is_available,"onUpdate:checked":p=>s.eventForm.weekly_hours[m].is_available=p,onChange:p=>i.checkTimes(m)},{default:_(()=>[y("  "+B(r),1)]),_:2},1032,["checked","onUpdate:checked","onChange"])]),o("div",nt,[n(N,{ref_for:!0,ref:"scheduleRuleTime_"+m,modelValue:s.eventForm.weekly_hours[m].hours,"onUpdate:modelValue":p=>s.eventForm.weekly_hours[m].hours=p,errors:s.eventErrors,"error-key-prefix":`weekly_hours.${m}.hours`,onTimeRangeRemoved:p=>i.timeRangeRemoved(m)},null,8,["modelValue","onUpdate:modelValue","errors","error-key-prefix","onTimeRangeRemoved"])]),o("div",lt,[n(z,{type:"button",icon:s.icon.add,onClick:p=>i.addTimeRange(m)},null,8,["icon","onClick"])])])]))),128))])])])]),o("div",dt,[o("div",ct,[ut,o("div",mt,[o("div",_t,[vt,o("div",ht,[n(k,{class:"is-info is-fullwidth",type:"button",onClick:t[11]||(t[11]=r=>i.openDateOverrideModal())},{default:_(()=>[y(" Add Date ")]),_:1})]),o("div",pt,[(d(!0),c(O,null,F(i.dateOverrideBatches,(r,m)=>(d(),c("div",{key:m,class:"columns is-multiline"},[o("div",ft,B(i.displayDates(m)),1),o("div",gt,[r[0].is_available?(d(),c("div",bt,[(d(!0),c(O,null,F(r[0].times,(p,A)=>(d(),c("div",{key:A,class:"column is-full"},B(p.started_time.substr(0,5))+" - "+B(p.ended_time.substr(0,5)),1))),128))])):(d(),w(P,{key:1,class:"is-warning is-medium is-italic"},{default:_(()=>[y(" Unavailable ")]),_:1}))]),o("div",yt,[o("div",Bt,[o("div",kt,[n(z,{type:"button",class:"is-danger",icon:s.icon.remove,onClick:p=>i.removeDateOverride(m)},null,8,["icon","onClick"])]),o("div",Dt,[n(z,{type:"button",icon:s.icon.edit,onClick:p=>i.openDateOverrideModal(m)},null,8,["icon","onClick"])])])]),i.dateOverrideBatchErrors[m]?(d(),c("div",Ot,[(d(!0),c(O,null,F(i.dateOverrideBatchErrors[m],(p,A)=>(d(),c("p",{key:A,class:"help is-danger has-text-centered"},B(p),1))),128))])):V("",!0)]))),128))])])])])])]),Ft,o("div",zt,[o("div",Mt,[n(g,{href:e.route(a.baseRouteName+".index"),class:"is-link is-light"},{default:_(()=>[y(" Cancel ")]),_:1},8,["href"])]),o("div",Vt,[n(k,{class:"is-link"},{default:_(()=>[y(" Update ")]),_:1})])])])],32)]),_:1}),n(D,{title:"Manager","is-rendered":a.can.productManager.edit},{default:_(()=>[a.can.productManager.edit?(d(),c("form",{key:0,class:"box",onSubmit:t[14]||(t[14]=S((...r)=>i.submitManager&&i.submitManager(...r),["prevent"]))},[n(Y,{modelValue:l.productManagers,"onUpdate:modelValue":t[13]||(t[13]=r=>l.productManagers=r),label:"Choose Product Manager","get-users-url":e.route(a.productManagerBaseRoute+".search",a.product.id)},null,8,["modelValue","get-users-url"]),o("div",Et,[o("div",qt,[n(k,{class:"is-link"},{default:_(()=>[y(" Update ")]),_:1})])])],32)):V("",!0)]),_:1},8,["is-rendered"])]),_:1},8,["modelValue"]),e.isModalOpen?(d(),w(H,{key:0,id:"product-event-date-override-modal",modelValue:l.selectedDateOverrideBatch,"onUpdate:modelValue":t[16]||(t[16]=r=>l.selectedDateOverrideBatch=r),onClose:t[17]||(t[17]=r=>e.closeModal()),onAfterApply:i.afterApply},null,8,["modelValue","onAfterApply"])):V("",!0)])}const Ro=fe(ge,[["render",At]]);export{Ro as default};
