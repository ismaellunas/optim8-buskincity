import{M as b}from"./HasLoader-a564cfe6.js";import{A as v}from"./AppLayout-40f8bbe7.js";import{B as S}from"./ErrorNotifications-090d6193.js";import{B as T}from"./FlashNotifications-b6fadc75.js";import _ from"./Form-3738925f.js";import{c,a as d,o as w,s as P}from"./alert-fe3154bb.js";import{I as f,B,L as D,M,H as u,l as C,J as g,f as E,p as m,i as N,r as p,o as F}from"./vue-loading.min-a6a947f0.js";import{g as h}from"./page-9994df2c.js";import{g as a}from"./translation-2d24d0f6.js";import{i as L}from"./utils-caa7a80b.js";import{o as I}from"./FormBuilder-2690236c.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";import"./Breadcrumbs-f0ae94d4.js";import"./Link-359d994c.js";import"./NavbarItem-766600c9.js";import"./HasModal-fa56130c.js";import"./Button-03e0d3fd.js";import"./ButtonIcon-b1d1d2b0.js";import"./Icon-6def3c13.js";import"./ButtonLink-abb08373.js";import"./LanguageTab-ce3e8bfb.js";import"./Select-a178b677.js";import"./Field-a8082082.js";import"./Field-e1691255.js";import"./InputError-9b7084c8.js";import"./Select-19a91b6e.js";import"./ModalCard-06597c5e.js";import"./Tabs-f6aab556.js";import"./FormDetail-a9a0c7f5.js";import"./HasPageErrors-da5616c1.js";import"./Input-137492c5.js";import"./Input-4c73d710.js";import"./Slug-e3370d8d.js";import"./InputAddons-7c9a4924.js";import"./icon-class-4ab3933f.js";import"./Textarea-0e8af5bc.js";import"./Textarea-fb59ae31.js";import"./FormSetting-16b7afea.js";import"./NumberAddons-1b722e6e.js";import"./Number-91e213dc.js";import"./style-options-cda219e9.js";import"./Card-64180043.js";import"./TRBLInput-8cbbcf29.js";import"./Checkbox-8f917da5.js";import"./FieldHorizontal-bfc51f07.js";import"./sweetalert2.all-7b2d1616.js";import"./MediaTextEditor-a29275ff.js";import"./MediaLibrary-02fe4347.js";import"./ButtonsDisplayView-20deee35.js";import"./Dropdown-034da47d.js";import"./Search-4389f740.js";import"./Image-c2b8efed.js";import"./InputFile-216a7277.js";import"./Gallery-86a7e0a4.js";import"./ButtonDownload-7545f1b2.js";import"./Modal-655bec1f.js";import"./Table-6b0ddb68.js";import"./cropper-72988d76.js";import"./Pagination-c4350b04.js";import"./TableInfo-6db2c6af.js";import"./Form-7bfdff43.js";import"./fontawesome-brand-classes-8350be4e.js";import"./DropdownSearch-eb09b8b3.js";import"./DropdownSearch-d54bf8fb.js";import"./vuedraggable.umd-d7851836.js";import"./ToolbarContent-b501238f.js";import"./EditorTinymce-3bb5766f.js";const k={name:"PageEdit",components:{BizErrorNotifications:S,BizFlashNotifications:T,PageForm:_},mixins:[b],provide(){return{can:this.can,media:this.media,settingOptions:this.settingOptions}},layout:v,props:{affectedFooterMenu:{type:Object,default:()=>{}},affectedHeaderMenu:{type:Object,default:()=>{}},can:{type:Object,required:!0},errors:{type:Object,default:()=>{}},page:{type:Object,required:!0},statusOptions:{type:Array,default:()=>[]},settingOptions:{type:Object,default:()=>{}},title:{type:String,required:!0},media:{type:Object,default:()=>{}}},setup(e){const t=f().props.value.defaultLanguage,o={[t]:{}};let i=a(e.page,t);L(i)&&(i=h()),o[t]=JSON.parse(JSON.stringify(i));const r=B("");function s(n){I(n,r)}return D(()=>{window.addEventListener("click",s)}),M(()=>{window.removeEventListener("click",s)}),{contentConfigId:r,defaultLocale:t,footerMenuItems:e.footerMenuItems,form:u(o),headerMenuItems:e.headerMenuItems,localeOptions:f().props.value.languageOptions}},data(){return{disableInput:!1,isNew:!1,selectedLocale:this.defaultLocale}},computed:{selectedLocaleName(){return C.find(this.localeOptions,{id:this.selectedLocale}).name??""},emptyPageLocaleOptions(){const e=this;return e.localeOptions.map(function(t){return a(e.page,t.id)?null:t}).filter(Boolean)}},methods:{isUsedByMenu(){const e=this;return new Promise((t,o)=>{const i=route("admin.api.pages.is-used-by-menu",{page:e.page.id,locale:e.selectedLocale});axios.get(i).then(r=>{t(r.data==!0)}).catch(r=>{o(r)})})},async canSavePage(){try{let e=a(this.page,this.selectedLocale);const t=this.form[this.selectedLocale].status;return e&&e.status==g.published&&t==g.draft&&await this.isUsedByMenu()?!!(await c("Are You Sure?","This action will also remove the page on the navigation menu.","Yes")).value:!0}catch(e){return console.error(e),!0}},async onSubmit(){if(await this.canSavePage()){const e=route("admin.pages.update",{id:this.page.id});this.form.put(e,{onStart:this.onStartLoadingOverlay,onFinish:this.onEndLoadingOverlay,onSuccess:()=>{const t=a(this.page,this.selectedLocale);this.form[this.selectedLocale].id=t.id}})}},onChangeLocale(e){this.form.isDirty?d().then(t=>{if(t.isDismissed)return!1;t.isConfirmed&&this.changeLocale(e)}):this.changeLocale(e)},changeLocale(e){this.setTranslationForm(e),this.selectedLocale=e},setTranslationForm(e){let t=a(this.page,e),o={[this.defaultLocale]:{}};L(t)||typeof t>"u"?o[e]=h():o[e]=JSON.parse(JSON.stringify(t)),this.form=u(o)},onDeleteTranslation(){const e=this;c("Are you sure want to delete the "+e.selectedLocaleName+" translation?").then(t=>{var o;t.isConfirmed&&e.$inertia.delete(route("admin.pages.translations.destroy",(o=e.form[e.selectedLocale])==null?void 0:o.id),{onStart:e.onStartLoadingOverlay,onFinish:e.onEndLoadingOverlay,onError:()=>{w()},onSuccess:i=>{P(i.props.flash.message),e.changeLocale(e.defaultLocale)}})})},onDuplicateTranslation(e){this.form.isDirty?d().then(t=>{if(t.isDismissed)return!1;t.isConfirmed&&this.duplicateTranslation(e)}):this.duplicateTranslation(e)},duplicateTranslation(e){this.changeLocale(e.locale);const t=this.form[this.selectedLocale];Object.keys(e.form).forEach(o=>{t[o]=e.form[o]})}}},U={class:"box mb-6"};function x(e,t,o,i,r,s){const n=p("biz-error-notifications"),y=p("biz-flash-notifications"),O=p("page-form");return F(),E("div",null,[m(n,{errors:e.$page.props.errors},null,8,["errors"]),m(y,{flash:e.$page.props.flash},null,8,["flash"]),N("div",U,[m(O,{modelValue:i.form[r.selectedLocale],"onUpdate:modelValue":t[0]||(t[0]=l=>i.form[r.selectedLocale]=l),"content-config-id":i.contentConfigId,"onUpdate:contentConfigId":t[1]||(t[1]=l=>i.contentConfigId=l),errors:o.errors,"is-dirty":i.form.isDirty,"is-new":r.isNew,"locale-options":i.localeOptions,"page-preview":!0,"selected-locale":r.selectedLocale,"status-options":o.statusOptions,"empty-page-locale-options":s.emptyPageLocaleOptions,onOnChangeLocale:s.onChangeLocale,onOnSubmit:s.onSubmit,onOnDeleteTranslation:s.onDeleteTranslation,onOnDuplicateTranslation:s.onDuplicateTranslation},null,8,["modelValue","content-config-id","errors","is-dirty","is-new","locale-options","selected-locale","status-options","empty-page-locale-options","onOnChangeLocale","onOnSubmit","onOnDeleteTranslation","onOnDuplicateTranslation"])])])}const Ze=j(k,[["render",x]]);export{Ze as default};
