import{M as C}from"./HasPageErrors-4d447fdf.js";import{B as F}from"./Button-b3acaac2.js";import{B as k}from"./DateTime-b3a25f5d.js";import{B as y}from"./Input-50a73630.js";import{B as D}from"./Textarea-18e9b25c.js";import{B as T}from"./LanguageTab-090d99fd.js";import{B as R}from"./ModalCard-42b1747b.js";import{I as _,l as m,B as f,H as g,u as O,q as c,r as d,o as p,i as n,t as v,p as i,k as b,f as E,F as N,s as L,w as M}from"./vue-loading.min-aa20e13d.js";import{i as B}from"./utils-79a9c8b1.js";import{a as A,s as U}from"./alert-e0e75cb7.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import"./Datepicker-847140ac.js";import"./Field-fbae01a6.js";import"./Field-c2e062a9.js";import"./InputError-bc1e9f36.js";import"./Input-2fb71e37.js";import"./Textarea-3c29db5c.js";import"./sweetalert2.all-ebd52f41.js";const q={name:"SpaceEventFormModal",components:{BizButton:F,BizFormDateTime:k,BizFormInput:y,BizFormTextarea:D,BizLanguageTab:T,BizModalCard:R},mixins:[C],props:{selectedEvent:{type:Object,default:()=>{}},space:{type:Object,required:!0}},emits:["close","after-submit"],setup(t){const e=_().props.value.defaultLanguage;let a=t.locale??e;const s=m.sortBy(_().props.value.languageOptions,[function(o){return o.id!=a}]);return typeof m.find(s,{id:a})>"u"&&(a=e),{defaultLocale:e,localeOptions:s,selectedLocale:f(a),startTime:f({hours:10,minutes:0}),endTime:f({hours:17,minutes:0})}},data(){return{eventRecord:{},formErrors:{},form:{}}},computed:{isNew(){return!this.eventRecord.id},isFormReady(){return!B(this.form)},selectableLocales(){return this.eventRecord.id?this.localeOptions:[m.find(this.localeOptions,["id",this.defaultLocale])]},startedEndedAt:{get(){return this.form.started_at?[this.form.started_at,this.form.ended_at]:[]},set(t){t==null?this.form.started_at=this.form.ended_at=null:(this.form.started_at=t[0]??null,this.form.ended_at=t[1]??null)}}},beforeMount:async function(){var t;(t=this.selectedEvent)!=null&&t.id?(this.eventRecord=await this.getRecord(),this.setForm(this.selectedLocale)):this.form=g(this.newEvent())},methods:{isBlank:B,newEvent(){const t={title:null,address:null,started_at:null,ended_at:null,translations:{}};return t.translations[this.selectedLocale]=this.newTranslation(),t},newTranslation(){return{excerpt:null,description:null}},getRecord(){const t=route("admin.spaces.events.show",{space:this.space.id,event:this.selectedEvent.id});return axios.get(t).then(e=>e.data)},onChangeLocale(t){const e=this;if(t==this.selectedLocale)return!1;this.form.isDirty?A().then(a=>{if(a.isDismissed)return!1;a.isConfirmed&&(e.setForm(t),e.selectedLocale=t)}):(e.setForm(t),e.selectedLocale=t)},setForm(t){const e=m.cloneDeep(this.eventRecord);e.translations={},this.eventRecord.translations[t]?e.translations[t]=m.cloneDeep(this.eventRecord.translations[t]):e.translations[t]=this.newTranslation(),e.started_at?e.started_at=new Date(e.started_at):e.started_at=new Date,e.ended_at?e.ended_at=new Date(e.ended_at):e.ended_at=new Date,this.form=g(e)},submit(){const t=this;let e=null,a=null;t.form.id?(e="put",a=route("admin.spaces.events.update",[t.space.id,t.form.id])):(e="post",a=route("admin.spaces.events.store",t.space.id)),axios[e](a,t.form.data()).then(s=>{t.eventRecord=s.data.event,t.setForm(t.selectedLocale),U(s.data.message),t.$emit("after-submit"),t.formErrors={}}).catch(s=>{t.formErrors=s.response.data.errors})}}},P={class:"modal-card-title has-text-weight-bold"},j={class:"columns"},H={class:"column is-half"},I={class:"box"},G={class:"columns"},J={class:"column"},K={class:"columns",style:{width:"100%"}},Q={class:"column"},W={class:"is-pulled-right"};function X(t,e,a,s,o,l){const w=d("biz-form-input"),z=d("biz-form-date-time"),u=d("biz-form-textarea"),x=d("biz-language-tab"),h=d("biz-button"),V=d("biz-modal-card");return p(),O(V,{"content-class":"is-huge",onClose:e[8]||(e[8]=r=>t.$emit("close"))},{header:c(()=>[n("p",P,v(l.isNew?"Add New Event":"Edit Event"),1),n("button",{"aria-label":"close",class:"delete",onClick:e[0]||(e[0]=r=>t.$emit("close"))})]),footer:c(()=>[n("div",K,[n("div",Q,[n("div",W,[i(h,{onClick:e[7]||(e[7]=r=>t.$emit("close"))},{default:c(()=>[b(" Cancel ")]),_:1}),i(h,{class:"is-primary ml-1",type:"button",onClick:l.submit},{default:c(()=>[b(v(l.isNew?"Create":"Update"),1)]),_:1},8,["onClick"])])])])]),default:c(()=>[l.isBlank(o.form)?L("",!0):(p(),E("form",{key:0,onSubmit:e[6]||(e[6]=M((...r)=>l.submit&&l.submit(...r),["prevent"]))},[i(w,{modelValue:o.form.title,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.title=r),label:"Title",maxlength:"255",required:"",message:t.error("title",null,o.formErrors)},null,8,["modelValue","message"]),n("div",j,[n("div",H,[i(z,{modelValue:l.startedEndedAt,"onUpdate:modelValue":e[2]||(e[2]=r=>l.startedEndedAt=r),label:"Started at and Ended at",required:"","multi-calendars":"","multi-calendars-solo":"",range:"",utc:"preserve",message:t.error(["started_at","ended_at"],null,o.formErrors),"start-time":[s.startTime,s.endTime]},null,8,["modelValue","message","start-time"])])]),i(u,{modelValue:o.form.address,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.address=r),label:"Address",placeholder:"Address",rows:"2",maxlength:"500",message:t.error("address",null,o.formErrors)},null,8,["modelValue","message"]),n("div",I,[n("div",G,[n("div",J,[i(x,{class:"is-right","locale-options":l.selectableLocales,"selected-locale":s.selectedLocale,onOnChangeLocale:l.onChangeLocale},null,8,["locale-options","selected-locale","onOnChangeLocale"])])]),o.form.translations[s.selectedLocale]?(p(),E(N,{key:0},[i(u,{modelValue:o.form.translations[s.selectedLocale].excerpt,"onUpdate:modelValue":e[4]||(e[4]=r=>o.form.translations[s.selectedLocale].excerpt=r),label:"Excerpt",placeholder:"Excerpt",rows:"2",maxlength:"800",message:t.error("translations."+s.selectedLocale+".excerpt",null,o.formErrors)},null,8,["modelValue","message"]),i(u,{modelValue:o.form.translations[s.selectedLocale].description,"onUpdate:modelValue":e[5]||(e[5]=r=>o.form.translations[s.selectedLocale].description=r),label:"Description",placeholder:"Description",rows:"5",maxlength:"65000",message:t.error("translations."+s.selectedLocale+".description",null,o.formErrors)},null,8,["modelValue","message"])],64)):L("",!0)])],32))]),_:1})}const he=S(q,[["render",X]]);export{he as default};
