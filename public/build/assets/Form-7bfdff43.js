import{M as w}from"./HasPageErrors-da5616c1.js";import{B as O}from"./Button-03e0d3fd.js";import{o as r,f as n,I as T,l as f,A as S,B as k,H as j,p as m,i as u,F as B,j as y,q as _,s as b,u as z,w as x,r as c,n as M,t as C,k as F}from"./vue-loading.min-a6a947f0.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";import{B as U}from"./ButtonIcon-b1d1d2b0.js";import{B as P}from"./ErrorNotifications-090d6193.js";import{B as q}from"./Input-137492c5.js";import{B as H}from"./Textarea-0e8af5bc.js";import{B as K}from"./Select-19a91b6e.js";import{i as R}from"./icon-class-4ab3933f.js";import{f as G,h as J}from"./utils-caa7a80b.js";import{c as Q}from"./alert-fe3154bb.js";import"./Icon-6def3c13.js";import"./Field-a8082082.js";import"./Field-e1691255.js";import"./Input-4c73d710.js";import"./InputError-9b7084c8.js";import"./Textarea-fb59ae31.js";import"./sweetalert2.all-7b2d1616.js";const W={},X={class:"delete"};function Y(t,e,a,i,s,l){return r(),n("button",X)}const Z=V(W,[["render",Y]]);function h(){return{alt:"",description:""}}function D(t,e){const a=Object.keys(t);return e.filter(i=>!a.includes(i.id))}function L(t,e){return D(t,e).find(Boolean)}const $={name:"MediaForm",mixins:[w],components:{BizButton:O,BizButtonDelete:Z,BizButtonIcon:U,BizErrorNotifications:P,BizFormInput:q,BizFormTextarea:H,BizSelect:K},emits:["cancel","on-success-submit","on-error-submit"],props:{isAjax:{type:Boolean,default:!1},media:Object},setup(t){let e={};const a=T().props.value.defaultLanguage;f.isEmpty(t.media.translations)?e[a]=h():(t.media.translations.forEach(d=>{e[d.locale]={alt:d.alt??null,description:d.description??null}}),e[a]||(e[a]=h()));let i=S({_method:"post",file:null,file_name:t.media.file_name,translations:e});const s=T().props.value.languageOptions,l=L(e,s),p=k((l==null?void 0:l.id)??null);return{activeTab:k(a),defaultLocale:a,form:i,localeOptions:s,selectedLocale:p}},data(){return{isInputDisabled:!1,formErrors:{},label:{alternative_text:"Alternative Text",description:"Description"},loader:null,icon:R}},computed:{availableLocales(){return D(this.form.translations,this.localeOptions)},usedLocales(){const t=f.keys(this.form.translations);return this.localeOptions.filter(e=>t.includes(e.id))},isImage(){return this.media.is_image},canSubmit(){return!f.isEmpty(this.form.file_name)}},methods:{resetFirstAvailableLocale(){const t=L(this.form.translations,this.localeOptions);t&&(this.selectedLocale=(t==null?void 0:t.id)??null)},createNewTranslation(t){this.form.translations[t]=h()},setActiveTab(t){this.activeTab!==t&&(this.activeTab=t)},addTranslation(){const t=this.selectedLocale;this.createNewTranslation(t),this.setActiveTab(t),this.resetFirstAvailableLocale()},deleteTranslation(t,e){Q().then(a=>{if(a.isConfirmed){delete this.form.translations[e];const i=f.keys(this.form.translations);i.includes(this.activeTab)||this.setActiveTab(f.last(i)),this.resetFirstAvailableLocale()}})},keyPressFileName(t){let e=String.fromCharCode(t.keyCode);const a=t.target.value.slice(-1);if((e===" "||e==="_")&&a!=="-")t.target.value+="-";else if(e==="-"&&a==="-")t.target.value+="";else if(new RegExp("^["+G+"]+$").test(e))return!0;t.preventDefault()},submit(){const t=this.form,e=this;let a=null;if(this.media.id?(a=route("admin.media.update",this.media.id),t._method="put"):(this.isAjax?a=route("admin.api.media.store"):a=route("admin.media.store"),t.file=this.media.file),e.loader=e.$loading.show(),e.isInputDisabled=!0,this.isAjax){const i=new FormData;J(i,t),axios.post(a,i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(s){e.$emit("on-success-submit",s)}).catch(function(s){e.$emit("on-error-submit",s)}).then(()=>{e.loader.hide(),e.isInputDisabled=!1})}else j(t).post(a,{onSuccess:s=>{e.$emit("on-success-submit",s),e.formErrors={}},onError:s=>{e.formErrors=s},onFinish:()=>{e.loader.hide(),e.isInputDisabled=!1}})}}},ee={class:"tabs is-boxed"},te=["onClick"],ie={key:0},ae=["value"],se={key:0,class:"content"},oe={class:"field is-grouped is-pulled-right"};function le(t,e,a,i,s,l){const p=c("biz-error-notifications"),d=c("biz-form-input"),E=c("biz-button-delete"),A=c("biz-select"),I=c("biz-button-icon"),N=c("biz-form-textarea"),v=c("biz-button");return r(),n("div",null,[m(p,{errors:s.formErrors},null,8,["errors"]),u("form",{onSubmit:e[5]||(e[5]=x(o=>l.submit(i.form,a.media.id),["prevent"]))},[m(d,{modelValue:i.form.file_name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.form.file_name=o),label:"File Name",maxlength:"250",required:"",message:t.error("file_name","default",s.formErrors),disabled:s.isInputDisabled,onOnKeypress:l.keyPressFileName},null,8,["modelValue","message","disabled","onOnKeypress"]),u("div",ee,[u("ul",null,[(r(!0),n(B,null,y(l.usedLocales,o=>(r(),n("li",{class:M({"is-active":o.id==i.activeTab}),key:o.id},[u("a",{onClick:x(g=>l.setActiveTab(o.id),["prevent"])},[u("span",null,C(o.id.toUpperCase()),1),o.id!==i.defaultLocale?(r(),z(E,{key:0,class:"ml-1",type:"button",onClick:g=>l.deleteTranslation(g,o.id)},null,8,["onClick"])):b("",!0)],8,te)],2))),128)),l.availableLocales.length?(r(),n("li",ie,[m(A,{modelValue:i.selectedLocale,"onUpdate:modelValue":e[1]||(e[1]=o=>i.selectedLocale=o)},{default:_(()=>[(r(!0),n(B,null,y(l.availableLocales,o=>(r(),n("option",{value:o.id},C(o.name),9,ae))),256))]),_:1},8,["modelValue"]),m(I,{icon:s.icon.add,type:"button",onClick:l.addTranslation},null,8,["icon","onClick"])])):b("",!0)])]),i.form.translations[i.activeTab]?(r(),n("div",se,[l.isImage?(r(),z(d,{key:0,modelValue:i.form.translations[i.activeTab].alt,"onUpdate:modelValue":e[2]||(e[2]=o=>i.form.translations[i.activeTab].alt=o),maxlength:"255",disabled:s.isInputDisabled,label:s.label.alternative_text,message:t.error("translations."+i.activeTab+".alt")},null,8,["modelValue","disabled","label","message"])):b("",!0),m(N,{label:s.label.description,modelValue:i.form.translations[i.activeTab].description,"onUpdate:modelValue":e[3]||(e[3]=o=>i.form.translations[i.activeTab].description=o),placeholder:"...",rows:"3",message:t.error("translations."+i.activeTab+".description"),disabled:s.isInputDisabled},null,8,["label","modelValue","message","disabled"])])):b("",!0),u("div",oe,[m(v,{class:"is-link",disabled:!l.canSubmit},{default:_(()=>[F(" Submit ")]),_:1},8,["disabled"]),m(v,{class:"is-link is-light ml-2",type:"button",onClick:e[4]||(e[4]=o=>t.$emit("cancel"))},{default:_(()=>[F(" Cancel ")]),_:1})])],32)])}const Ce=V($,[["render",le]]);export{Ce as default};
