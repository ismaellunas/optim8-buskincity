import{M as x}from"./HasLoader-a564cfe6.js";import{B as C}from"./Button-03e0d3fd.js";import{M as F}from"./HasModal-fa56130c.js";import{B as z}from"./Password-6c802cd8.js";import{B as M}from"./ModalCard-06597c5e.js";import{r as h,o as i,f as a,i as e,x as S,u as _,q as s,t as w,k as b,p as c,a1 as B,n as g,s as u,F as T,j as P}from"./vue-loading.min-a6a947f0.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";import{F as E}from"./ActionSection-1ddbfc03.js";import{o as f}from"./alert-fe3154bb.js";import"./Field-a8082082.js";import"./Field-e1691255.js";import"./ButtonIcon-b1d1d2b0.js";import"./Icon-6def3c13.js";import"./icon-class-4ab3933f.js";import"./InputError-9b7084c8.js";import"./utils-caa7a80b.js";import"./sweetalert2.all-7b2d1616.js";const R={name:"BizConfirmPassword",components:{BizButton:C,BizFormPassword:z,BizModalCard:M},mixins:[F],props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],data(){return{form:{password:"",error:""}}},methods:{startConfirmingPassword(){axios.get(route("password.confirmation")).then(n=>{n.data.confirmed?this.$emit("confirmed"):(this.openModal(),setTimeout(()=>this.$refs.password.$refs.input.focus(),250))})},confirmPassword(){this.form.processing=!0,axios.post(route("password.confirm"),{password:this.form.password}).then(()=>{this.form.processing=!1,this.closeModal(),this.$nextTick(()=>this.$emit("confirmed"))}).catch(n=>{this.form.processing=!1,this.form.error=n.response.data.errors.password[0],this.$refs.password.$refs.input.focus()})},closeModal(){this.isModalOpen=!1,this.form.password="",this.form.error=""}}},A={class:"modal-card-title has-text-weight-bold"},L={class:"mt-4"};function q(n,r,p,k,o,t){const m=h("biz-form-password"),l=h("biz-button"),y=h("biz-modal-card");return i(),a("span",null,[e("span",{onClick:r[0]||(r[0]=(...d)=>t.startConfirmingPassword&&t.startConfirmingPassword(...d))},[S(n.$slots,"default")]),n.isModalOpen?(i(),_(y,{key:0,onClose:r[3]||(r[3]=d=>t.closeModal())},{header:s(()=>[e("p",A,w(p.title),1),e("button",{class:"delete","aria-label":"close",onClick:r[1]||(r[1]=d=>t.closeModal())})]),default:s(()=>[b(w(p.content)+" ",1),e("div",L,[c(m,{ref:"password",modelValue:o.form.password,"onUpdate:modelValue":r[2]||(r[2]=d=>o.form.password=d),placeholder:"Password",message:o.form.error,required:!0,onKeyup:B(t.confirmPassword,["enter"])},null,8,["modelValue","message","onKeyup"])])]),footer:s(()=>[c(l,{onClick:t.closeModal},{default:s(()=>[b(" Cancel ")]),_:1},8,["onClick"]),c(l,{class:g(["is-primary",{"opacity-25":o.form.processing}]),disabled:o.form.processing,onClick:t.confirmPassword},{default:s(()=>[b(w(p.button),1)]),_:1},8,["class","disabled","onClick"])]),_:1})):u("",!0)])}const V=v(R,[["render",q]]),O={components:{BizButton:C,BizConfirmPassword:V,FormActionSection:E},mixins:[x],data(){return{enabling:!1,disabling:!1,qrCode:null,recoveryCodes:[]}},computed:{twoFactorEnabled(){return!this.enabling&&this.$page.props.user.two_factor_enabled}},methods:{enableTwoFactorAuthentication(){this.enabling=!0,this.onStartLoadingOverlay(),this.$inertia.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([this.showQrCode(),this.showRecoveryCodes()]),onError:()=>{f()},onFinish:()=>{this.enabling=!1,this.onEndLoadingOverlay()}})},showQrCode(){let n=this;return axios.get("/user/two-factor-qr-code").then(r=>{n.qrCode=r.data.svg}).catch(()=>{f()})},showRecoveryCodes(){let n=this;return axios.get("/user/two-factor-recovery-codes").then(r=>{n.recoveryCodes=r.data}).catch(()=>{f()})},regenerateRecoveryCodes(){let n=this;axios.post("/user/two-factor-recovery-codes").then(r=>{n.showRecoveryCodes()}).catch(()=>{f()})},disableTwoFactorAuthentication(){this.disabling=!0,this.onStartLoadingOverlay(),this.$inertia.delete("/user/two-factor-authentication",{preserveScroll:!0,onError:()=>{f()},onFinish:()=>{this.disabling=!1,this.onEndLoadingOverlay()}})}}},H={key:0},N={key:1},K=e("div",{class:"mt-3"},[e("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1),Q={key:2},Y={key:0},D=e("div",{class:"mt-4"},[e("p",{class:"has-text-weight-semibold"}," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application. ")],-1),j=["innerHTML"],G={key:1},U=e("div",{class:"mt-4"},[e("p",{class:"has-text-weight-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1),W={class:"mt-4 px-4 py-4"},I={class:"mt-5"},J={key:0},X=e("span",{class:"has-text-weight-bold"},"Enable",-1),Z={key:1},$=e("span",{class:"has-text-weight-bold"},"Regenerate Recovery Codes",-1),ee=e("span",{class:"has-text-weight-bold"},"Show Recovery Codes",-1),oe=e("span",{class:"has-text-weight-bold"},"Disable",-1);function te(n,r,p,k,o,t){const m=h("biz-button"),l=h("biz-confirm-password"),y=h("form-action-section");return i(),_(y,null,{title:s(()=>[b(" Two Factor Authentication ")]),content:s(()=>[t.twoFactorEnabled?(i(),a("h3",H," You have enabled two factor authentication. ")):(i(),a("h3",N," You have not enabled two factor authentication. ")),K,t.twoFactorEnabled?(i(),a("div",Q,[o.qrCode?(i(),a("div",Y,[D,e("div",{class:"mt-4",innerHTML:o.qrCode},null,8,j)])):u("",!0),o.recoveryCodes.length>0?(i(),a("div",G,[U,e("div",W,[(i(!0),a(T,null,P(o.recoveryCodes,d=>(i(),a("div",{key:d},w(d),1))),128))])])):u("",!0)])):u("",!0),e("div",I,[t.twoFactorEnabled?(i(),a("div",Z,[c(l,{onConfirmed:t.regenerateRecoveryCodes},{default:s(()=>[o.recoveryCodes.length>0?(i(),_(m,{key:0,class:"is-medium"},{default:s(()=>[$]),_:1})):u("",!0)]),_:1},8,["onConfirmed"]),c(l,{onConfirmed:t.showRecoveryCodes},{default:s(()=>[o.recoveryCodes.length===0?(i(),_(m,{key:0,class:"is-medium"},{default:s(()=>[ee]),_:1})):u("",!0)]),_:1},8,["onConfirmed"]),c(l,{onConfirmed:t.disableTwoFactorAuthentication},{default:s(()=>[c(m,{class:g(["is-medium is-danger ml-2",{"opacity-25":o.disabling}]),disabled:o.disabling},{default:s(()=>[oe]),_:1},8,["class","disabled"])]),_:1},8,["onConfirmed"])])):(i(),a("div",J,[c(l,{onConfirmed:t.enableTwoFactorAuthentication},{default:s(()=>[c(m,{class:g(["is-medium is-primary",{"opacity-25":o.enabling}]),disabled:o.enabling},{default:s(()=>[X]),_:1},8,["class","disabled"])]),_:1},8,["onConfirmed"])]))])]),_:1})}const ge=v(O,[["render",te]]);export{ge as default};
