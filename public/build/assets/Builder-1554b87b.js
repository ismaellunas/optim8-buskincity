import{B as F}from"./ErrorNotifications-805a6bc2.js";import{B as L}from"./LanguageTab-090d99fd.js";import{M as B}from"./HasLoader-a564cfe6.js";import{B as O}from"./Button-b3acaac2.js";import{F as N}from"./FieldGroup-38323628.js";import{I as y,l as a,H as x,r as d,o as n,f as c,F as _,j as b,u as S,x as E,i as f,p as h,q as k,t as z,w as C,s as V,B as w}from"./vue-loading.min-aa20e13d.js";import{s as G,o as I}from"./alert-e0e75cb7.js";import{_ as v}from"./_plugin-vue_export-helper-c27b6911.js";const T={name:"FormField",components:{BizButton:O,FieldGroup:N},mixins:[B],props:{entityId:{type:Number,default:null},formField:{type:Object,required:!0},localeOptions:{type:Object,default:()=>{}},routeName:{type:String,required:!0},routeSave:{type:String,default:"forms.save"},selectedLocale:{type:String,required:!0}},emits:["on-success-submit"],data(){return{form:null,formFieldKey:0}},computed:{buttonText(){var e,t;return((t=(e=this.formField)==null?void 0:e.button)==null?void 0:t.text)??"Submit"}},mounted(){this.form=this.createForm()},methods:{createForm(){let e=null;const t={id:this.entityId,_token:y().props.value.csrfToken};return a.forOwn(this.formField.fieldGroups,(o,l)=>{a.isEmpty(o.fields)||a.forOwn(o.fields,(r,s)=>{typeof r.value>"u"?t[s]=void 0:(t[s]=r.value,r.is_translated&&r.value.length==0&&(e={},this.localeOptions.forEach(function(i){e[i.id]=null}),t[s]=e))})}),x(t)},submit(){const e=this;this.form.transform(t=>({...t,key:e.formField.key,route_name:e.routeName})).post(route(e.routeSave),{preserveScroll:!0,onStart:()=>{e.onStartLoadingOverlay()},onSuccess:t=>{G(t.props.flash.message),e.$emit("on-success-submit"),e.resetFields()},onError:t=>{I({isScrollToTop:!1})},onFinish:t=>{e.onEndLoadingOverlay(),e.formFieldKey+=1}})},resetFields(){a.forEach(this.$refs,(e,t)=>{a.forEach(e.$refs,(o,l)=>{o.reset&&o.reset()})})}}},q={class:"field"},K={class:"has-text-weight-bold"};function j(e,t,o,l,r,s){const i=d("field-group"),p=d("biz-button");return r.form?(n(),c("form",{key:r.formFieldKey,onSubmit:t[1]||(t[1]=C((...u)=>s.submit&&s.submit(...u),["prevent"]))},[(n(!0),c(_,null,b(o.formField.fieldGroups,(u,m)=>(n(),S(i,{key:m,ref_for:!0,ref:"field_group__"+m,modelValue:r.form,"onUpdate:modelValue":t[0]||(t[0]=g=>r.form=g),group:u,"selected-locale":o.selectedLocale},null,8,["modelValue","group","selected-locale"]))),128)),E(e.$slots,"buttons",{},()=>[f("div",q,[h(p,{class:"is-medium is-primary"},{default:k(()=>[f("span",K,z(s.buttonText),1)]),_:1})])])],32)):V("",!0)}const M=v(T,[["render",j]]),H={name:"FormBuilder",components:{BizErrorNotifications:F,BizLanguageTab:L,FormField:M},provide(){return{bagName:this.bagName}},props:{bagName:{type:String,default:"formBuilder"},entityId:{type:Number,default:null},locale:{type:String,default:null},routeGetSchemas:{type:String,default:"forms.schemas"},routeName:{type:String,required:!0},routeSave:{type:String,default:"forms.save"}},emits:["loaded-empty-field","loaded-forbidden","loaded-successfully"],setup(e){const t=y().props.value.defaultLanguage;let o=e.locale??t;const l=a.sortBy(y().props.value.languageOptions,[function(r){return r.id!=o}]);return typeof a.find(l,{id:o})>"u"&&(o=t),{localeOptions:l,selectedLocale:w(o)}},data(){return{forms:{},loader:null}},computed:{sortedForms(){return a.sortBy(this.forms,["order"])}},mounted(){this.getSchemas()},methods:{getSchemas(){const e=this;return axios.get(route(e.routeGetSchemas),{params:{id:e.entityId,route_name:e.routeName}}).then(t=>{e.forms=t.data,e.$emit("loaded-successfully",t.data),a.isEmpty(this.forms)&&e.$emit("loaded-empty-field")}).catch(t=>{t.response&&t.response.status==403&&e.$emit("loaded-forbidden",t.response)})},onChangeLocale(e){this.selectedLocale=e}}},D={class:"columns"},P={class:"column"};function U(e,t,o,l,r,s){const i=d("biz-language-tab"),p=d("biz-error-notifications"),u=d("form-field");return n(),c("div",null,[f("div",D,[f("div",P,[h(i,{class:"is-right","locale-options":l.localeOptions,"selected-locale":l.selectedLocale,onOnChangeLocale:s.onChangeLocale},null,8,["locale-options","selected-locale","onOnChangeLocale"])])]),h(p,{bags:[o.bagName],errors:e.$page.props.errors},null,8,["bags","errors"]),(n(!0),c(_,null,b(s.sortedForms,(m,g)=>(n(),S(u,{key:g,class:"mb-5","entity-id":o.entityId,"form-field":m,"locale-options":l.localeOptions,"selected-locale":l.selectedLocale,"route-name":o.routeName,"route-save":o.routeSave,onOnSuccessSubmit:t[0]||(t[0]=$=>s.getSchemas())},null,8,["entity-id","form-field","locale-options","selected-locale","route-name","route-save"]))),128))])}const ee=v(H,[["render",U]]);export{ee as F};
