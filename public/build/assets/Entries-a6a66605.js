import{M as V}from"./FilterDataHandle-94157290.js";import{M as j}from"./HasLoader-a564cfe6.js";import{M as I}from"./HasTab-77ca33c2.js";import{A as Q}from"./AppLayout-25ccdbdb.js";import{B as H}from"./Button-b3acaac2.js";import{B as W}from"./ButtonLink-71ebb617.js";import{B as G}from"./Checkbox-8d9a17c8.js";import{B as J}from"./CheckboxToggle-b36e31d6.js";import{B as K,a as X}from"./Dropdown-5425ae3a.js";import{B as Y}from"./Search-cafe34ab.js";import{B as Z}from"./Icon-150b61ef.js";import{B as $}from"./Link-2bcf0cab.js";import{B as ee,a as te}from"./TabList-c5e61712.js";import{B as ie}from"./TableIndex-6b2a4ef8.js";import{i as re}from"./icon-class-4ab3933f.js";import{o as S,s as q,c as R}from"./alert-e0e75cb7.js";import{B,R as ae,l as se,f as d,p as o,q as a,i as u,s as c,u as m,r as h,o as s,F as A,j as w,k as b,t as E,w as p,n as x}from"./vue-loading.min-aa20e13d.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";import"./Breadcrumbs-0b4348b1.js";import"./utils-79a9c8b1.js";import"./NavbarItem-7e983d41.js";import"./ButtonIcon-05c24ca4.js";import"./Field-c2e062a9.js";import"./Input-2fb71e37.js";import"./Pagination-8d9b0028.js";import"./Table-2efbef14.js";import"./TableInfo-c372d0e5.js";import"./sweetalert2.all-ebd52f41.js";const le={name:"FormBuilderEntries",components:{BizButton:H,BizButtonLink:W,BizCheckbox:G,BizCheckboxToggle:J,BizDropdown:K,BizDropdownItem:X,BizFilterSearch:Y,BizIcon:Z,BizLink:$,BizTab:ee,BizTabList:te,BizTableIndex:ie},mixins:[V,j,I],layout:Q,props:{can:{type:Object,default:()=>{}},baseRouteName:{type:String,required:!0},fieldLabels:{type:Object,default:()=>{}},fieldNames:{type:Object,default:()=>{}},formBuilder:{type:Object,required:!0},pageQueryParams:{type:Object,default:()=>{}},records:{type:Object,default:()=>{}},readOptions:{type:Array,default:()=>[]}},setup(e){var l,v;const t={entries:{title:"Entries",available:!0},archived:{title:"Archived",available:e.can.restore}},i=B({});return{activeTab:B(((l=e.pageQueryParams)==null?void 0:l.tab)??"entries"),icon:re,isAll:B(!1),filterParams:i,queryParams:ae(()=>_.pickBy({...e.pageQueryParams,...i.value},n=>!_.isNull(n))),queryReads:B([]),rawSelectedEntries:B([]),term:B(((v=e.pageQueryParams)==null?void 0:v.term)??null),tabs:t}},computed:{isDataEmpty(){return se.isEmpty(this.records.data)},isArchivedTab(){return this.activeTab=="archived"},canBulkMarkAsRead(){const e=this;return!this.isArchivedTab&&this.rawSelectedEntries.length>0&&_.findIndex(this.rawSelectedEntries,function(t){var i;return!((i=_.find(e.records.data,{id:t}))!=null&&i.isRead)})>=0},canBulkMarkAsUnread(){const e=this;return!this.isArchivedTab&&this.rawSelectedEntries.length>0&&_.findIndex(this.rawSelectedEntries,function(t){var i;return(i=_.find(e.records.data,{id:t}))==null?void 0:i.isRead})>=0},canBulkArchive(){return this.rawSelectedEntries.length>0&&!this.isArchivedTab},canBulkRestore(){return this.rawSelectedEntries.length>0&&this.isArchivedTab},canBulkForceDelete(){return this.canBulkRestore}},methods:{hasUnreadIndicator(e){return!this.isArchivedTab&&!e.isRead},refreshWithQueryParams(){this.$inertia.get(route(this.baseRouteName+".index",{form_builder:this.formBuilder.id}),this.queryParams,{replace:!0,preserveState:!0,onStart:()=>this.onStartLoadingOverlay(),onFinish:()=>this.onEndLoadingOverlay()})},onReadOptionChanged(e){this.filterParams.read=e.id,this.refreshWithQueryParams()},selectAllToggle(){this.isAll?(this.rawSelectedEntries=[],this.isAll=!1):(this.rawSelectedEntries=this.records.data.map(e=>e.id),this.isAll=!0)},bulkActionRequest(e,t){const i=this;this.$inertia.post(route(e,{form_builder:this.formBuilder.id,...this.queryParams}),{entries:this.rawSelectedEntries},{onStart:()=>this.onStartLoadingOverlay(),onFinish:l=>{i.onEndLoadingOverlay()},onError:l=>{S()},onSuccess:l=>{q(l.props.flash.message),_.isFunction(t)&&t(l)}})},actionRequest(e,t,i){const l=this;this.$inertia.post(route(e,{form_builder:this.formBuilder.id,...this.queryParams}),{entries:[t.id]},{onStart:()=>this.onStartLoadingOverlay(),onFinish:v=>{l.onEndLoadingOverlay()},onError:v=>{S()},onSuccess:v=>{q(v.props.flash.message),_.isFunction(i)&&i(v)}})},bulkMarkAsRead(){this.bulkActionRequest(this.baseRouteName+".bulk-mark-as-read")},bulkMarkAsUnread(){this.bulkActionRequest(this.baseRouteName+".bulk-mark-as-unread")},bulkArchive(){const e=this;R("Confirm Archive","Are you sure?").then(t=>{t.isConfirmed&&this.bulkActionRequest(this.baseRouteName+".bulk-archive",function(){e.rawSelectedEntries=[]})})},bulkRestore(){const e=this;R("Confirm Restore","Are you sure?").then(t=>{t.isConfirmed&&this.bulkActionRequest(this.baseRouteName+".bulk-restore",function(){e.rawSelectedEntries=[]})})},bulkForceDelete(){const e=this;R("Are you sure?","Once the resources are deleted, they will be permanently deleted.","Confirm Deletion").then(t=>{t.isConfirmed&&this.bulkActionRequest(this.baseRouteName+".bulk-restore",function(){e.rawSelectedEntries=[]})})},markAsRead(e){this.actionRequest(this.baseRouteName+".bulk-mark-as-read",e)},markAsUnread(e){this.actionRequest(this.baseRouteName+".bulk-mark-as-unread",e)},archive(e){R("Confirm Archive","Are you sure?").then(t=>{t.isConfirmed&&this.actionRequest(this.baseRouteName+".bulk-archive",e)})},restore(e){R("Confirm Restore","Are you sure?").then(t=>{t.isConfirmed&&this.actionRequest(this.baseRouteName+".bulk-restore",e)})},forceDelete(e){R("Are you sure?","Once the resource is deleted, it will be permanently deleted.","Confirm Deletion").then(t=>{t.isConfirmed&&this.actionRequest(this.baseRouteName+".bulk-force-delete",e)})}}},oe={class:"box"},de={class:"columns"},ce={class:"column is-4"},ue={key:0,class:"column"},me=u("span",null,"Filter",-1),he=u("span",null,"Actions",-1),be=u("th",null,"Action",-1),fe=["innerHTML"],ke={class:"has-text-weight-normal"},_e={class:"buttons"},ve={class:"icon is-small"},ye={key:0},Ae=u("td",{colspan:"99",class:"has-text-centered"}," Data is empty ",-1),ge=[Ae];function Re(e,t,i,l,v,n){const D=h("biz-link"),M=h("biz-tab-list"),T=h("biz-tab"),N=h("biz-filter-search"),C=h("biz-icon"),g=h("biz-button"),f=h("biz-dropdown-item"),z=h("biz-dropdown"),L=h("biz-checkbox-toggle"),O=h("biz-checkbox"),F=h("biz-button-link"),P=h("biz-table-index");return s(),d("div",oe,[o(T,{class:"is-boxed"},{default:a(()=>[u("ul",null,[(s(!0),d(A,null,w(l.tabs,(r,k)=>(s(),d(A,{key:k},[r.available?(s(),m(M,{key:0,"is-active":e.isTabActive(k)},{default:a(()=>[o(D,{href:e.route("admin.form-builders.entries.index",{tab:k,form_builder:i.formBuilder.id})},{default:a(()=>[b(E(r.title),1)]),_:2},1032,["href"])]),_:2},1032,["is-active"])):c("",!0)],64))),128))])]),_:1}),u("div",de,[u("div",ce,[o(N,{modelValue:l.term,"onUpdate:modelValue":t[0]||(t[0]=r=>l.term=r),onSearch:e.search},null,8,["modelValue","onSearch"])]),n.isArchivedTab?c("",!0):(s(),d("div",ue,[o(z,{"close-on-click":!0},{trigger:a(()=>[me,o(C,{icon:l.icon.angleDown},null,8,["icon"])]),default:a(()=>[(s(!0),d(A,null,w(i.readOptions,r=>(s(),m(f,{key:r.id,class:"p-0"},{default:a(()=>[o(g,{type:"button",class:"is-white is-fullwidth",onClick:p(k=>n.onReadOptionChanged(r),["prevent"])},{default:a(()=>[b(E(r.value),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))]),i.can.markAsRead||i.can.markAsUnread||i.can.archive||i.can.restore||i.can.forceDelete?(s(),m(z,{key:0,class:"mb-4","close-on-click":!0},{trigger:a(()=>[he,o(C,{icon:l.icon.angleDown},null,8,["icon"])]),default:a(()=>[n.isArchivedTab?(s(),d(A,{key:1},[i.can.restore?(s(),m(f,{key:0,class:"px-0"},{default:a(()=>[o(g,{class:"is-white is-fullwidth",type:"button",disabled:!n.canBulkRestore,onClick:t[4]||(t[4]=r=>n.bulkRestore())},{default:a(()=>[b(" Restore ")]),_:1},8,["disabled"])]),_:1})):c("",!0),i.can.restore?(s(),m(f,{key:1,class:"px-0"},{default:a(()=>[o(g,{class:"is-white is-fullwidth",type:"button",disabled:!n.canBulkForceDelete,onClick:t[5]||(t[5]=r=>n.bulkForceDelete())},{default:a(()=>[b(" Delete ")]),_:1},8,["disabled"])]),_:1})):c("",!0)],64)):(s(),d(A,{key:0},[i.can.markAsRead?(s(),m(f,{key:0,class:"px-0"},{default:a(()=>[o(g,{class:"is-white is-fullwidth",type:"button",disabled:!n.canBulkMarkAsRead,onClick:t[1]||(t[1]=r=>n.bulkMarkAsRead())},{default:a(()=>[b(" Mark as read ")]),_:1},8,["disabled"])]),_:1})):c("",!0),i.can.markAsUnread?(s(),m(f,{key:1,class:"px-0"},{default:a(()=>[o(g,{class:"is-white is-fullwidth",type:"button",disabled:!n.canBulkMarkAsUnread,onClick:t[2]||(t[2]=r=>n.bulkMarkAsUnread())},{default:a(()=>[b(" Mark as unread ")]),_:1},8,["disabled"])]),_:1})):c("",!0),i.can.archive?(s(),m(f,{key:2,class:"px-0"},{default:a(()=>[o(g,{class:"is-white is-fullwidth",type:"button",disabled:!n.canBulkArchive,onClick:t[3]||(t[3]=r=>n.bulkArchive())},{default:a(()=>[b(" Archive ")]),_:1},8,["disabled"])]),_:1})):c("",!0)],64))]),_:1})):c("",!0),o(P,{records:i.records,"query-params":l.queryParams},{thead:a(()=>[u("tr",null,[u("th",null,[o(L,{modelValue:l.isAll,"onUpdate:modelValue":t[6]||(t[6]=r=>l.isAll=r),onClick:n.selectAllToggle},null,8,["modelValue","onClick"])]),(s(!0),d(A,null,w(i.fieldLabels,(r,k)=>(s(),d("th",{key:k},E(r),1))),128)),be])]),default:a(()=>[(s(!0),d(A,null,w(i.records.data,(r,k)=>(s(),d("tr",{key:k,class:x({"has-text-weight-semibold":n.hasUnreadIndicator(r)})},[u("td",null,[o(O,{checked:l.rawSelectedEntries,"onUpdate:checked":t[7]||(t[7]=y=>l.rawSelectedEntries=y),value:r.id},null,8,["checked","value"])]),(s(!0),d(A,null,w(i.fieldNames,(y,U)=>(s(),d("td",{key:U,innerHTML:r[y]},null,8,fe))),128)),u("td",ke,[u("div",_e,[o(F,{class:"is-ghost has-text-black",title:"View",href:e.route(i.baseRouteName+".show",{form_builder:i.formBuilder.id,form_entry:r.id})},{default:a(()=>[u("span",ve,[u("i",{class:x(l.icon.eye)},null,2)])]),_:2},1032,["href"]),o(z,{class:x(["is-right",{"is-up":k>i.records.data.length-3}])},{trigger:a(()=>[o(C,{class:"is-small",icon:l.icon.ellipsis},null,8,["icon"])]),default:a(()=>[r.can.mark_as_read?(s(),m(f,{key:0,tag:"a",onClick:p(y=>n.markAsRead(r),["prevent"])},{default:a(()=>[b(" Mark as read ")]),_:2},1032,["onClick"])):c("",!0),r.can.mark_as_unread?(s(),m(f,{key:1,tag:"a",onClick:p(y=>n.markAsUnread(r),["prevent"])},{default:a(()=>[b(" Mark as unread ")]),_:2},1032,["onClick"])):c("",!0),r.can.archive?(s(),m(f,{key:2,tag:"a",onClick:p(y=>n.archive(r),["prevent"])},{default:a(()=>[b(" Archive ")]),_:2},1032,["onClick"])):c("",!0),r.can.restore?(s(),m(f,{key:3,tag:"a",onClick:p(y=>n.restore(r),["prevent"])},{default:a(()=>[b(" Restore ")]),_:2},1032,["onClick"])):c("",!0),r.can.force_delete?(s(),m(f,{key:4,tag:"a",onClick:p(y=>n.forceDelete(r),["prevent"])},{default:a(()=>[b(" Delete ")]),_:2},1032,["onClick"])):c("",!0)]),_:2},1032,["class"])])])],2))),128)),n.isDataEmpty&&i.records.current_page==1?(s(),d("tr",ye,ge)):c("",!0)]),_:1},8,["records","query-params"])])}const Ye=ne(le,[["render",Re]]);export{Ye as default};
