import{M as S}from"./FilterDataHandle-94157290.js";import{M as x}from"./HasModal-fa56130c.js";import{A as w}from"./AppLayout-40f8bbe7.js";import O from"./ModalEntryDetail-f360b1df.js";import{B as A}from"./Checkbox-8f917da5.js";import{B as P}from"./ButtonIcon-b1d1d2b0.js";import{B as V}from"./DateRange-a8219f55.js";import{B as q}from"./Search-4389f740.js";import{B as E}from"./TableIndex-c25c722c.js";import{i as F}from"./icon-class-4ab3933f.js";import{c as b}from"./alert-fe3154bb.js";import{l as v,B as k,f as g,i as o,p as h,u as c,q as p,w as y,s as m,r as d,o as i,F as L,j as N,t as f}from"./vue-loading.min-a6a947f0.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./HasLoader-a564cfe6.js";import"./Breadcrumbs-f0ae94d4.js";import"./Link-359d994c.js";import"./utils-caa7a80b.js";import"./NavbarItem-766600c9.js";import"./Button-03e0d3fd.js";import"./ModalCard-06597c5e.js";import"./Table-6b0ddb68.js";import"./Icon-6def3c13.js";import"./Datepicker-4f509259.js";import"./moment-fbc5633a.js";import"./Field-e1691255.js";import"./Input-4c73d710.js";import"./Pagination-c4350b04.js";import"./TableInfo-6db2c6af.js";import"./sweetalert2.all-7b2d1616.js";const U={name:"ErrorLog",components:{ModalEntryDetail:O,BizCheckbox:A,BizButtonIcon:P,BizFilterDateRange:V,BizFilterSearch:q,BizTableIndex:E},mixins:[S,x],layout:w,props:{baseRouteName:{type:String,required:!0},can:{type:Object,required:!0},pageQueryParams:{type:Object,default:()=>{}},records:{type:Object,required:!0}},setup(e){var n,l,a;const t=v.merge({},e.pageQueryParams);return{queryParams:k(t),term:k(((n=e.pageQueryParams)==null?void 0:n.term)??null),dates:k(v.isArray((l=e.pageQueryParams)==null?void 0:l.dates)?(a=e.pageQueryParams)==null?void 0:a.dates.filter(Boolean):[])}},data(){return{icon:F,selectedEntry:null,checkedRecords:[]}},computed:{hasRecords(){return this.records.data.length>0},canDeleteCheckedRecords(){return this.checkedRecords.length>0&&this.can.delete}},methods:{viewDetail(e){this.selectedEntry=e,this.openModal()},onDateRangeChanged(){this.queryParams.dates=this.dates,this.refreshWithQueryParams()},deleteRecord(e){const t=this;b().then(n=>{n.isConfirmed&&t.$inertia.delete(route(t.baseRouteName+".destroy",e.id),{onStart:()=>t.onStartLoadingOverlay(),onFinish:()=>t.onEndLoadingOverlay()})})},deleteAllRecords(){const e=this;b("Are you sure?","All records will be deleted, You won't be able to revert this!").then(t=>{t.isConfirmed&&e.$inertia.delete(route(e.baseRouteName+".destroy.all"),{onStart:()=>e.onStartLoadingOverlay(),onFinish:()=>e.onEndLoadingOverlay()})})},deleteCheckedRecords(){const e=this;b().then(t=>{t.isConfirmed&&e.$inertia.post(route(e.baseRouteName+".destroy.checked"),{recordIds:e.checkedRecords},{onStart:()=>e.onStartLoadingOverlay(),onFinish:()=>{e.onEndLoadingOverlay(),e.checkedRecords=[]}})})},onFinishRefreshWithQueryParams(){this.checkedRecords=[]},limitString(e,t=100){return e.length>100?e.substring(0,t)+"...":e}}},j={class:"box"},I={class:"columns"},H={class:"column is-4"},T={class:"column is-4"},W={class:"column is-4 has-text-right"},Y=o("span",null,"Delete Checked Records",-1),G=o("span",null,"Delete All",-1),J=o("tr",null,[o("th",null,"#"),o("th",null,"Created At"),o("th",null,"URL"),o("th",null,"Total Hit"),o("th",{width:"30%"}," Message "),o("th",{width:"12%"}," Actions ")],-1),K={style:{"word-break":"break-word"}};function X(e,t,n,l,a,s){const R=d("biz-filter-search"),C=d("biz-filter-date-range"),u=d("biz-button-icon"),B=d("biz-checkbox"),M=d("biz-table-index"),z=d("modal-entry-detail");return i(),g("div",null,[o("div",j,[o("div",I,[o("div",H,[h(R,{modelValue:l.term,"onUpdate:modelValue":t[0]||(t[0]=r=>l.term=r),onSearch:e.search},null,8,["modelValue","onSearch"])]),o("div",T,[h(C,{modelValue:l.dates,"onUpdate:modelValue":[t[1]||(t[1]=r=>l.dates=r),s.onDateRangeChanged]},null,8,["modelValue","onUpdate:modelValue"])]),o("div",W,[s.canDeleteCheckedRecords?(i(),c(u,{key:0,class:"is-danger",type:"button",icon:a.icon.remove,onClick:t[2]||(t[2]=y(r=>s.deleteCheckedRecords(),["prevent"]))},{default:p(()=>[Y]),_:1},8,["icon"])):m("",!0),n.can.delete?(i(),c(u,{key:1,class:"is-danger ml-2",type:"button",icon:a.icon.remove,disabled:!s.hasRecords,onClick:t[3]||(t[3]=y(r=>s.deleteAllRecords(),["prevent"]))},{default:p(()=>[G]),_:1},8,["icon","disabled"])):m("",!0)])]),h(M,{records:n.records,"query-params":l.queryParams},{thead:p(()=>[J]),default:p(()=>[(i(!0),g(L,null,N(n.records.data,(r,D)=>(i(),g("tr",{key:D},[o("td",null,[h(B,{checked:a.checkedRecords,"onUpdate:checked":t[4]||(t[4]=_=>a.checkedRecords=_),value:r.id},null,8,["checked","value"])]),o("td",null,f(r.createdAtFormatted),1),o("td",null,f(s.limitString(r.url)),1),o("td",null,f(r.total_hit),1),o("td",K,f(s.limitString(r.message)),1),o("td",null,[n.can.read?(i(),c(u,{key:0,class:"is-ghost has-text-black ml-1","icon-class":"is-small",title:"View",type:"button",icon:a.icon.eye,onClick:y(_=>s.viewDetail(r),["prevent"])},null,8,["icon","onClick"])):m("",!0),n.can.delete?(i(),c(u,{key:1,class:"is-ghost has-text-black ml-1","icon-class":"is-small",title:"Delete",type:"button",icon:a.icon.remove,onClick:y(_=>s.deleteRecord(r),["prevent"])},null,8,["icon","onClick"])):m("",!0)])]))),128))]),_:1},8,["records","query-params"])]),e.isModalOpen?(i(),c(z,{key:0,entry:a.selectedEntry,onCloseModal:e.closeModal,onOpenModal:e.openModal},null,8,["entry","onCloseModal","onOpenModal"])):m("",!0)])}const De=Q(U,[["render",X]]);export{De as default};
