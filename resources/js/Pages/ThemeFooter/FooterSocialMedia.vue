<template>
    <div>
        <div class="columns">
            <div class="column">
                <div class="is-pulled-left">
                    <b>
                        {{ i18n.social_media }}
                    </b>
                </div>
            </div>
        </div>
        <div class="columns">
            <div class="column">
                <nav class="panel">
                    <div class="panel-block p-4 has-text-weight-bold">
                        {{ i18n.social_media_items }}
                    </div>
                    <div
                        v-for="(socialMedia, index) in socialMediaMenus"
                        :key="index"
                        class="panel-block p-4"
                    >
                        <div
                            class="level"
                            style="width:100%"
                        >
                            <div class="level-left">
                                <span class="panel-icon">
                                    <i
                                        :class="socialMedia.icon"
                                        aria-hidden="true"
                                    />
                                </span>
                                {{ socialMedia.url ?? "-" }}
                            </div>
                            <div class="level-right">
                                <biz-button
                                    class="is-ghost has-text-black"
                                    @click.prevent="openFormModal(socialMedia, index)"
                                >
                                    <span class="icon is-small">
                                        <i :class="icon.edit" />
                                    </span>
                                </biz-button>
                                <biz-button
                                    class="is-ghost has-text-black ml-1"
                                    @click.prevent="deleteSocialMedia(index)"
                                >
                                    <span class="icon is-small">
                                        <i :class="icon.remove" />
                                    </span>
                                </biz-button>
                            </div>
                        </div>
                    </div>
                    <a
                        class="panel-block p-4 has-text-link"
                        @click.prevent="openFormModal()"
                    >
                        <span class="panel-icon has-text-link">
                            <i
                                :class="icon.add"
                                aria-hidden="true"
                            />
                        </span>
                        <span class="ml-2">
                            {{ sentenceCase(i18n.add_social_media) }}
                        </span>
                    </a>
                </nav>
            </div>
        </div>

        <footer-social-media-form
            v-if="isModalOpen"
            :errors="socialMediaErrors"
            :social-media="selectedSocialMedia"
            :selected-index="selectedIndex"
            @add-social-media="addSocialMedia"
            @close="closeModal()"
            @update-social-media="updateSocialMedia"
        />
    </div>
</template>

<script>
    import MixinHasModal from '@/Mixins/HasModal';
    import BizButton from '@/Biz/Button.vue';
    import FooterSocialMediaForm from './FooterSocialMediaForm.vue';
    import { useModelWrapper } from '@/Libs/utils';
    import { confirmDelete } from '@/Libs/alert';
    import { cloneDeep } from 'lodash';
    import icon from '@/Libs/icon-class';
    import { sentenceCase } from 'change-case';

    export default {
        name: 'FooterSocialMedia',

        components: {
            BizButton,
            FooterSocialMediaForm,
        },

        mixins: [
            MixinHasModal,
        ],

        inject: {
            i18n: { default: () => ({
                social_media : 'Social media',
                social_media_items : 'Social media items',
                add_social_media : 'Add social media',
            }) },
        },

        props: {
            modelValue: {
                type: Array,
                required: true,
            },
        },

        setup(props, { emit }) {
            return {
                socialMediaMenus: useModelWrapper(props, emit),
            };
        },

        data() {
            return {
                icon,
                selectedIndex: null,
                selectedSocialMedia: {},
                socialMediaErrors: {},
                validationRoute: route('admin.api.theme.footer.social-media.validate'),
            };
        },

        methods: {
            openFormModal(socialMedia = null, index = null) {
                this.selectedSocialMedia = socialMedia ?? {};
                this.selectedIndex = index ?? null;
                this.socialMediaErrors = {};
                this.isModalOpen = true;
            },

            addSocialMedia(socialMedia) {
                const self = this;
                axios.post(self.validationRoute, socialMedia)
                    .then(() => {
                        self.socialMediaMenus.push(
                            cloneDeep(socialMedia)
                        );
                        self.closeModal();
                    })
                    .catch((error) => {
                        self.socialMediaErrors = error.response.data.errors;
                    });
            },

            updateSocialMedia(socialMedia) {
                const self = this;

                axios.post(self.validationRoute, socialMedia)
                    .then(() => {
                        self.closeModal();
                    })
                    .catch((error) => {
                        self.socialMediaErrors = error.response.data.errors;
                    });
            },

            deleteSocialMedia(index) {
                confirmDelete("Are you sure?").then((result) => {
                    if (result.isConfirmed) {
                        this.socialMediaMenus.splice(index, 1);
                        this.isModalOpen = false;
                    }
                });
            },

            sentenceCase,
        },
    }
</script>

<style scoped>
    .icon-pointer {
        cursor: pointer;
        border-radius: 100%;
    }
</style>